<html>
    <head>
        <title>Packet formatting plugins.</title>
    </head>
    <body>
        <h1>Packet formatting plugins</h1>
        <p>
            While the <a href="packets.html">packet</a> ids are well known
            and registered, the format of packet bodies, in general is the
            responsibilities of the maintainers of the device that produces them.
            This means that it is not possible for bufdump to have any intrinsic
            knowledge of the internal structures of event packets.
        </p>
        <p>
            We recognize that users may wish something more readable than
            a hex dump of the internals of a packet.   Therefore, bufdump
            supports <em>plugins</em>.  A plugin is a Tcl procedure that can
            be associated with a packet id.  When a packet id is encountered,
            if a plugin is registered for it, the procedure is called and expected
            to return the dump of the packet body.
        </p>
        <p>Plugins are installed dynamically via the
           <a href="fileplugin.html">File Add Plugin...</a> command.
            Plugin files can contain any number of plugins and the code to
            register them.  Probably the simplest way to describe a plugin is
            to give a simple example:
            <br />
            <pre>
# Plugin to format 0x8000 packets:
#
proc format8000 body {
    set result "Hex   Decimal   Octal\n"
    foreach item $body {
	append result [format "0x%04x %05d %06o\n" $item $item $item]
    }
return $result
}
registerPacketFormatter 0x8000 format8000
            </pre>
            <br />
            The Tcl procedure <b>format8000</b> constitutes the plugin.
            It receives the body of the packet as a parameter.  The body
            is passed as a Tcl list of numbers.  The procedure is expected
            to return the formatted packet exactly as it should appear in the
            dump window.  The sample above produces three columns that show
            the hexadecimal, decimal and octal values of the body words.
        <p/>
        <p>
            The call to <b>registerPacketForrmatter</b> lets bufdump know that a
            plugin is available for a packet id.  The first parameter is the packet
            type, the second, the name of the procedure that implements the plugin.
            The procedure name, should follow the convention shown above in order to
            ensure that it does not override any existing procedures within bufdump, nor
            override any other existing plugin.
        </p>
    <hr />
    <p>Please report all errors to http://daqbugs.nscl.msu.edu </p>
    </body>
</html>

#
#    This software is Copyright by the Board of Trustees of Michigan
#    State University (c) Copyright 2005.
#
#    You may use this software under the terms of the GNU public license
#    (GPL).  The terms of this license are described at:
#
#     http://www.gnu.org/licenses/gpl.txt
#
#     Author:
#             Ron Fox
#            NSCL
#            Michigan State University
#            East Lansing, MI 48824-1321
#
set here [file dirname [info script]]

# starting to just get too tough to do this without
# packaging:
package require tcltest

set auto_saved $auto_path
set auto_path [concat $here $auto_path]


if {[file exists pkgIndex.tcl]} {
    file delete              pkgIndex.tcl.saved
    file rename pkgIndex.tcl pkgIndex.tcl.saved
}
pkg_mkIndex . *.tcl

package require bufferAssembly
namespace import ::bufferAssembly::*

#---------------------------------------------------------------------

tcltest::test 1.0 {Full buffer in a single chunk}  \
    -body {
        set current [list]
        set size     1
        set chunk    2
        set output [nextChunk $current $size $chunk]
        set result [llength $output]
        lappend result [lindex $output 0] [lindex $output 1]

        set result

    }                                              \
    -result {2 2 {}}

#----------------------------------------------------------------------

tcltest::test 1.1 {Full buffer in 2 chunks} \
    -body {
        set current [list]
        set size     2
        set chunk 1
        set output [nextChunk $current $size $chunk]
        set result [llength $output];      # Sb. 1.
        set current [lindex $output 0]
        set output [nextChunk $current $size $chunk]
        lappend result [llength $output];   # Sb. 2
        lappend result [lindex $output 0]
        lappend result [lindex $output 1]
        set result
    }                                                  \
    -result {1 2 {1 1} {}}


#-----------------------------------------------------------------------
#
tcltest::test 1.2 {Buffer overflowed with residual} \
-body {
    set size 1
    set chunk [list 1 2 3]
    set current [list]
    set output [nextChunk $current $size $chunk]
    set result [llength $output]
    lappend result [lindex $output 0]
    lappend result [lindex $output 1]

    set result
}                                                   \
-result {2 1 {2 3}}
# Cleanup

file delete pkgIndex.tcl
if {[file exists pkgIndex.tcl.saved]} {
    file rename pkgIndex.tcl.saved pkgIndex.tcl
}
set auto_path $auto_saved


tcltest::cleanupTests

<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.0 Transitional//EN">
<html><head><meta http-equiv="Content-Type" content="text/html;charset=iso-8859-1">
<title>CSocket.cpp Source File</title>
<link href="doxygen.css" rel="stylesheet" type="text/css">
</head><body>
<!-- Generated by Doxygen 1.2.15 -->
<center>
<a class="qindex" href="main.html">Main Page</a> &nbsp; <a class="qindex" href="namespaces.html">Namespace List</a> &nbsp; <a class="qindex" href="hierarchy.html">Class Hierarchy</a> &nbsp; <a class="qindex" href="classes.html">Alphabetical List</a> &nbsp; <a class="qindex" href="annotated.html">Compound List</a> &nbsp; <a class="qindex" href="files.html">File List</a> &nbsp; <a class="qindex" href="functions.html">Compound Members</a> &nbsp; <a class="qindex" href="globals.html">File Members</a> &nbsp; <a class="qindex" href="pages.html">Related Pages</a> &nbsp; </center>
<hr><h1>CSocket.cpp</h1><a href="CSocket_8cpp.html">Go to the documentation of this file.</a><div class="fragment"><pre>00001 <font class="comment">/*</font>
00002 <font class="comment">                    GNU GENERAL PUBLIC LICENSE</font>
00003 <font class="comment">                       Version 2, June 1991</font>
00004 <font class="comment"></font>
00005 <font class="comment"> Copyright (C) 1989, 1991 Free Software Foundation, Inc.</font>
00006 <font class="comment">                       59 Temple Place, Suite 330, Boston, MA  02111-1307  USA</font>
00007 <font class="comment"> Everyone is permitted to copy and distribute verbatim copies</font>
00008 <font class="comment"> of this license document, but changing it is not allowed.</font>
00009 <font class="comment"></font>
00010 <font class="comment">                            Preamble</font>
00011 <font class="comment"></font>
00012 <font class="comment">  The licenses for most software are designed to take away your</font>
00013 <font class="comment">freedom to share and change it.  By contrast, the GNU General Public</font>
00014 <font class="comment">License is intended to guarantee your freedom to share and change free</font>
00015 <font class="comment">software--to make sure the software is free for all its users.  This</font>
00016 <font class="comment">General Public License applies to most of the Free Software</font>
00017 <font class="comment">Foundation's software and to any other program whose authors commit to</font>
00018 <font class="comment">using it.  (Some other Free Software Foundation software is covered by</font>
00019 <font class="comment">the GNU Library General Public License instead.)  You can apply it to</font>
00020 <font class="comment">your programs, too.</font>
00021 <font class="comment"></font>
00022 <font class="comment">  When we speak of free software, we are referring to freedom, not</font>
00023 <font class="comment">price.  Our General Public Licenses are designed to make sure that you</font>
00024 <font class="comment">have the freedom to distribute copies of free software (and charge for</font>
00025 <font class="comment">this service if you wish), that you receive source code or can get it</font>
00026 <font class="comment">if you want it, that you can change the software or use pieces of it</font>
00027 <font class="comment">in new free programs; and that you know you can do these things.</font>
00028 <font class="comment"></font>
00029 <font class="comment">  To protect your rights, we need to make restrictions that forbid</font>
00030 <font class="comment">anyone to deny you these rights or to ask you to surrender the rights.</font>
00031 <font class="comment">These restrictions translate to certain responsibilities for you if you</font>
00032 <font class="comment">distribute copies of the software, or if you modify it.</font>
00033 <font class="comment"></font>
00034 <font class="comment">  For example, if you distribute copies of such a program, whether</font>
00035 <font class="comment">gratis or for a fee, you must give the recipients all the rights that</font>
00036 <font class="comment">you have.  You must make sure that they, too, receive or can get the</font>
00037 <font class="comment">source code.  And you must show them these terms so they know their</font>
00038 <font class="comment">rights.</font>
00039 <font class="comment"></font>
00040 <font class="comment">  We protect your rights with two steps: (1) copyright the software, and</font>
00041 <font class="comment">(2) offer you this license which gives you legal permission to copy,</font>
00042 <font class="comment">distribute and/or modify the software.</font>
00043 <font class="comment"></font>
00044 <font class="comment">  Also, for each author's protection and ours, we want to make certain</font>
00045 <font class="comment">that everyone understands that there is no warranty for this free</font>
00046 <font class="comment">software.  If the software is modified by someone else and passed on, we</font>
00047 <font class="comment">want its recipients to know that what they have is not the original, so</font>
00048 <font class="comment">that any problems introduced by others will not reflect on the original</font>
00049 <font class="comment">authors' reputations.</font>
00050 <font class="comment"></font>
00051 <font class="comment">  Finally, any free program is threatened constantly by software</font>
00052 <font class="comment">patents.  We wish to avoid the danger that redistributors of a free</font>
00053 <font class="comment">program will individually obtain patent licenses, in effect making the</font>
00054 <font class="comment">program proprietary.  To prevent this, we have made it clear that any</font>
00055 <font class="comment">patent must be licensed for everyone's free use or not licensed at all.</font>
00056 <font class="comment"></font>
00057 <font class="comment">  The precise terms and conditions for copying, distribution and</font>
00058 <font class="comment">modification follow.</font>
00059 <font class="comment"></font>
00060 <font class="comment">                    GNU GENERAL PUBLIC LICENSE</font>
00061 <font class="comment">   TERMS AND CONDITIONS FOR COPYING, DISTRIBUTION AND MODIFICATION</font>
00062 <font class="comment"></font>
00063 <font class="comment">  0. This License applies to any program or other work which contains</font>
00064 <font class="comment">a notice placed by the copyright holder saying it may be distributed</font>
00065 <font class="comment">under the terms of this General Public License.  The "Program", below,</font>
00066 <font class="comment">refers to any such program or work, and a "work based on the Program"</font>
00067 <font class="comment">means either the Program or any derivative work under copyright law:</font>
00068 <font class="comment">that is to say, a work containing the Program or a portion of it,</font>
00069 <font class="comment">either verbatim or with modifications and/or translated into another</font>
00070 <font class="comment">language.  (Hereinafter, translation is included without limitation in</font>
00071 <font class="comment">the term "modification".)  Each licensee is addressed as "you".</font>
00072 <font class="comment"></font>
00073 <font class="comment">Activities other than copying, distribution and modification are not</font>
00074 <font class="comment">covered by this License; they are outside its scope.  The act of</font>
00075 <font class="comment">running the Program is not restricted, and the output from the Program</font>
00076 <font class="comment">is covered only if its contents constitute a work based on the</font>
00077 <font class="comment">Program (independent of having been made by running the Program).</font>
00078 <font class="comment">Whether that is true depends on what the Program does.</font>
00079 <font class="comment"></font>
00080 <font class="comment">  1. You may copy and distribute verbatim copies of the Program's</font>
00081 <font class="comment">source code as you receive it, in any medium, provided that you</font>
00082 <font class="comment">conspicuously and appropriately publish on each copy an appropriate</font>
00083 <font class="comment">copyright notice and disclaimer of warranty; keep intact all the</font>
00084 <font class="comment">notices that refer to this License and to the absence of any warranty;</font>
00085 <font class="comment">and give any other recipients of the Program a copy of this License</font>
00086 <font class="comment">along with the Program.</font>
00087 <font class="comment"></font>
00088 <font class="comment">You may charge a fee for the physical act of transferring a copy, and</font>
00089 <font class="comment">you may at your option offer warranty protection in exchange for a fee.</font>
00090 <font class="comment"></font>
00091 <font class="comment">  2. You may modify your copy or copies of the Program or any portion</font>
00092 <font class="comment">of it, thus forming a work based on the Program, and copy and</font>
00093 <font class="comment">distribute such modifications or work under the terms of Section 1</font>
00094 <font class="comment">above, provided that you also meet all of these conditions:</font>
00095 <font class="comment"></font>
00096 <font class="comment">    a) You must cause the modified files to carry prominent notices</font>
00097 <font class="comment">    stating that you changed the files and the date of any change.</font>
00098 <font class="comment"></font>
00099 <font class="comment">    b) You must cause any work that you distribute or publish, that in</font>
00100 <font class="comment">    whole or in part contains or is derived from the Program or any</font>
00101 <font class="comment">    part thereof, to be licensed as a whole at no charge to all third</font>
00102 <font class="comment">    parties under the terms of this License.</font>
00103 <font class="comment"></font>
00104 <font class="comment">    c) If the modified program normally reads commands interactively</font>
00105 <font class="comment">    when run, you must cause it, when started running for such</font>
00106 <font class="comment">    interactive use in the most ordinary way, to print or display an</font>
00107 <font class="comment">    announcement including an appropriate copyright notice and a</font>
00108 <font class="comment">    notice that there is no warranty (or else, saying that you provide</font>
00109 <font class="comment">    a warranty) and that users may redistribute the program under</font>
00110 <font class="comment">    these conditions, and telling the user how to view a copy of this</font>
00111 <font class="comment">    License.  (Exception: if the Program itself is interactive but</font>
00112 <font class="comment">    does not normally print such an announcement, your work based on</font>
00113 <font class="comment">    the Program is not required to print an announcement.)</font>
00114 <font class="comment"></font>
00115 <font class="comment">These requirements apply to the modified work as a whole.  If</font>
00116 <font class="comment">identifiable sections of that work are not derived from the Program,</font>
00117 <font class="comment">and can be reasonably considered independent and separate works in</font>
00118 <font class="comment">themselves, then this License, and its terms, do not apply to those</font>
00119 <font class="comment">sections when you distribute them as separate works.  But when you</font>
00120 <font class="comment">distribute the same sections as part of a whole which is a work based</font>
00121 <font class="comment">on the Program, the distribution of the whole must be on the terms of</font>
00122 <font class="comment">this License, whose permissions for other licensees extend to the</font>
00123 <font class="comment">entire whole, and thus to each and every part regardless of who wrote it.</font>
00124 <font class="comment"></font>
00125 <font class="comment">Thus, it is not the intent of this section to claim rights or contest</font>
00126 <font class="comment">your rights to work written entirely by you; rather, the intent is to</font>
00127 <font class="comment">exercise the right to control the distribution of derivative or</font>
00128 <font class="comment">collective works based on the Program.</font>
00129 <font class="comment"></font>
00130 <font class="comment">In addition, mere aggregation of another work not based on the Program</font>
00131 <font class="comment">with the Program (or with a work based on the Program) on a volume of</font>
00132 <font class="comment">a storage or distribution medium does not bring the other work under</font>
00133 <font class="comment">the scope of this License.</font>
00134 <font class="comment"></font>
00135 <font class="comment">  3. You may copy and distribute the Program (or a work based on it,</font>
00136 <font class="comment">under Section 2) in object code or executable form under the terms of</font>
00137 <font class="comment">Sections 1 and 2 above provided that you also do one of the following:</font>
00138 <font class="comment"></font>
00139 <font class="comment">    a) Accompany it with the complete corresponding machine-readable</font>
00140 <font class="comment">    source code, which must be distributed under the terms of Sections</font>
00141 <font class="comment">    1 and 2 above on a medium customarily used for software interchange; or,</font>
00142 <font class="comment"></font>
00143 <font class="comment">    b) Accompany it with a written offer, valid for at least three</font>
00144 <font class="comment">    years, to give any third party, for a charge no more than your</font>
00145 <font class="comment">    cost of physically performing source distribution, a complete</font>
00146 <font class="comment">    machine-readable copy of the corresponding source code, to be</font>
00147 <font class="comment">    distributed under the terms of Sections 1 and 2 above on a medium</font>
00148 <font class="comment">    customarily used for software interchange; or,</font>
00149 <font class="comment"></font>
00150 <font class="comment">    c) Accompany it with the information you received as to the offer</font>
00151 <font class="comment">    to distribute corresponding source code.  (This alternative is</font>
00152 <font class="comment">    allowed only for noncommercial distribution and only if you</font>
00153 <font class="comment">    received the program in object code or executable form with such</font>
00154 <font class="comment">    an offer, in accord with Subsection b above.)</font>
00155 <font class="comment"></font>
00156 <font class="comment">The source code for a work means the preferred form of the work for</font>
00157 <font class="comment">making modifications to it.  For an executable work, complete source</font>
00158 <font class="comment">code means all the source code for all modules it contains, plus any</font>
00159 <font class="comment">associated interface definition files, plus the scripts used to</font>
00160 <font class="comment">control compilation and installation of the executable.  However, as a</font>
00161 <font class="comment">special exception, the source code distributed need not include</font>
00162 <font class="comment">anything that is normally distributed (in either source or binary</font>
00163 <font class="comment">form) with the major components (compiler, kernel, and so on) of the</font>
00164 <font class="comment">operating system on which the executable runs, unless that component</font>
00165 <font class="comment">itself accompanies the executable.</font>
00166 <font class="comment"></font>
00167 <font class="comment">If distribution of executable or object code is made by offering</font>
00168 <font class="comment">access to copy from a designated place, then offering equivalent</font>
00169 <font class="comment">access to copy the source code from the same place counts as</font>
00170 <font class="comment">distribution of the source code, even though third parties are not</font>
00171 <font class="comment">compelled to copy the source along with the object code.</font>
00172 <font class="comment"></font>
00173 <font class="comment">  4. You may not copy, modify, sublicense, or distribute the Program</font>
00174 <font class="comment">except as expressly provided under this License.  Any attempt</font>
00175 <font class="comment">otherwise to copy, modify, sublicense or distribute the Program is</font>
00176 <font class="comment">void, and will automatically terminate your rights under this License.</font>
00177 <font class="comment">However, parties who have received copies, or rights, from you under</font>
00178 <font class="comment">this License will not have their licenses terminated so long as such</font>
00179 <font class="comment">parties remain in full compliance.</font>
00180 <font class="comment"></font>
00181 <font class="comment">  5. You are not required to accept this License, since you have not</font>
00182 <font class="comment">signed it.  However, nothing else grants you permission to modify or</font>
00183 <font class="comment">distribute the Program or its derivative works.  These actions are</font>
00184 <font class="comment">prohibited by law if you do not accept this License.  Therefore, by</font>
00185 <font class="comment">modifying or distributing the Program (or any work based on the</font>
00186 <font class="comment">Program), you indicate your acceptance of this License to do so, and</font>
00187 <font class="comment">all its terms and conditions for copying, distributing or modifying</font>
00188 <font class="comment">the Program or works based on it.</font>
00189 <font class="comment"></font>
00190 <font class="comment">  6. Each time you redistribute the Program (or any work based on the</font>
00191 <font class="comment">Program), the recipient automatically receives a license from the</font>
00192 <font class="comment">original licensor to copy, distribute or modify the Program subject to</font>
00193 <font class="comment">these terms and conditions.  You may not impose any further</font>
00194 <font class="comment">restrictions on the recipients' exercise of the rights granted herein.</font>
00195 <font class="comment">You are not responsible for enforcing compliance by third parties to</font>
00196 <font class="comment">this License.</font>
00197 <font class="comment"></font>
00198 <font class="comment">  7. If, as a consequence of a court judgment or allegation of patent</font>
00199 <font class="comment">infringement or for any other reason (not limited to patent issues),</font>
00200 <font class="comment">conditions are imposed on you (whether by court order, agreement or</font>
00201 <font class="comment">otherwise) that contradict the conditions of this License, they do not</font>
00202 <font class="comment">excuse you from the conditions of this License.  If you cannot</font>
00203 <font class="comment">distribute so as to satisfy simultaneously your obligations under this</font>
00204 <font class="comment">License and any other pertinent obligations, then as a consequence you</font>
00205 <font class="comment">may not distribute the Program at all.  For example, if a patent</font>
00206 <font class="comment">license would not permit royalty-free redistribution of the Program by</font>
00207 <font class="comment">all those who receive copies directly or indirectly through you, then</font>
00208 <font class="comment">the only way you could satisfy both it and this License would be to</font>
00209 <font class="comment">refrain entirely from distribution of the Program.</font>
00210 <font class="comment"></font>
00211 <font class="comment">If any portion of this section is held invalid or unenforceable under</font>
00212 <font class="comment">any particular circumstance, the balance of the section is intended to</font>
00213 <font class="comment">apply and the section as a whole is intended to apply in other</font>
00214 <font class="comment">circumstances.</font>
00215 <font class="comment"></font>
00216 <font class="comment">It is not the purpose of this section to induce you to infringe any</font>
00217 <font class="comment">patents or other property right claims or to contest validity of any</font>
00218 <font class="comment">such claims; this section has the sole purpose of protecting the</font>
00219 <font class="comment">integrity of the free software distribution system, which is</font>
00220 <font class="comment">implemented by public license practices.  Many people have made</font>
00221 <font class="comment">generous contributions to the wide range of software distributed</font>
00222 <font class="comment">through that system in reliance on consistent application of that</font>
00223 <font class="comment">system; it is up to the author/donor to decide if he or she is willing</font>
00224 <font class="comment">to distribute software through any other system and a licensee cannot</font>
00225 <font class="comment">impose that choice.</font>
00226 <font class="comment"></font>
00227 <font class="comment">This section is intended to make thoroughly clear what is believed to</font>
00228 <font class="comment">be a consequence of the rest of this License.</font>
00229 <font class="comment"></font>
00230 <font class="comment">  8. If the distribution and/or use of the Program is restricted in</font>
00231 <font class="comment">certain countries either by patents or by copyrighted interfaces, the</font>
00232 <font class="comment">original copyright holder who places the Program under this License</font>
00233 <font class="comment">may add an explicit geographical distribution limitation excluding</font>
00234 <font class="comment">those countries, so that distribution is permitted only in or among</font>
00235 <font class="comment">countries not thus excluded.  In such case, this License incorporates</font>
00236 <font class="comment">the limitation as if written in the body of this License.</font>
00237 <font class="comment"></font>
00238 <font class="comment">  9. The Free Software Foundation may publish revised and/or new versions of the General Public License from time to time.  Such new versions will be similar in spirit to the present version, but may differ in detail to address new problems or concerns.</font>
00239 <font class="comment"></font>
00240 <font class="comment">Each version is given a distinguishing version number.  If the Program</font>
00241 <font class="comment">specifies a version number of this License which applies to it and "any</font>
00242 <font class="comment">later version", you have the option of following the terms and conditions </font>
00243 <font class="comment">either of that version or of any later version published by the Free Software </font>
00244 <font class="comment">Foundation.  If the Program does not specify a version number of this License,</font>
00245 <font class="comment"> you may choose any version ever published by the Free Software Foundation.</font>
00246 <font class="comment"></font>
00247 <font class="comment">  10. If you wish to incorporate parts of the Program into other free</font>
00248 <font class="comment">programs whose distribution conditions are different, write to the author to </font>
00249 <font class="comment">ask for permission.  For software which is copyrighted by the Free Software </font>
00250 <font class="comment">Foundation, write to the Free Software Foundation; we sometimes make </font>
00251 <font class="comment">exceptions for this.  Our decision will be guided by the two goals of </font>
00252 <font class="comment">preserving the free status of all derivatives of our free software and of </font>
00253 <font class="comment">promoting the sharing and reuse of software generally.</font>
00254 <font class="comment"></font>
00255 <font class="comment">                            NO WARRANTY</font>
00256 <font class="comment"></font>
00257 <font class="comment">  11. BECAUSE THE PROGRAM IS LICENSED FREE OF CHARGE, THERE IS NO WARRANTY FOR</font>
00258 <font class="comment">THE PROGRAM, TO THE EXTENT PERMITTED BY APPLICABLE LAW.  EXCEPT WHEN </font>
00259 <font class="comment">OTHERWISE STATED IN WRITING THE COPYRIGHT HOLDERS AND/OR OTHER PARTIES PROVIDE </font>
00260 <font class="comment">THE PROGRAM "AS IS" WITHOUT WARRANTY OF ANY KIND, EITHER EXPRESSED OR IMPLIED, </font>
00261 <font class="comment">INCLUDING, BUT NOT LIMITED TO, THE IMPLIED WARRANTIES OF MERCHANTABILITY AND </font>
00262 <font class="comment">FITNESS FOR A PARTICULAR PURPOSE.  THE ENTIRE RISK AS TO THE QUALITY AND </font>
00263 <font class="comment">PERFORMANCE OF THE PROGRAM IS WITH YOU.  SHOULD THE PROGRAM PROVE DEFECTIVE, </font>
00264 <font class="comment">YOU ASSUME THE COST OF ALL NECESSARY SERVICING, REPAIR OR CORRECTION.</font>
00265 <font class="comment"></font>
00266 <font class="comment">  12. IN NO EVENT UNLESS REQUIRED BY APPLICABLE LAW OR AGREED TO IN WRITING </font>
00267 <font class="comment">WILL ANY COPYRIGHT HOLDER, OR ANY OTHER PARTY WHO MAY MODIFY AND/OR </font>
00268 <font class="comment">REDISTRIBUTE THE PROGRAM AS PERMITTED ABOVE, BE LIABLE TO YOU FOR DAMAGES, </font>
00269 <font class="comment">INCLUDING ANY GENERAL, SPECIAL, INCIDENTAL OR CONSEQUENTIAL DAMAGES ARISING </font>
00270 <font class="comment">OUT OF THE USE OR INABILITY TO USE THE PROGRAM (INCLUDING BUT NOT LIMITED TO </font>
00271 <font class="comment">LOSS OF DATA OR DATA BEING RENDERED INACCURATE OR LOSSES SUSTAINED BY YOU OR </font>
00272 <font class="comment">THIRD PARTIES OR A FAILURE OF THE PROGRAM TO OPERATE WITH ANY OTHER PROGRAMS), </font>
00273 <font class="comment">EVEN IF SUCH HOLDER OR OTHER PARTY HAS BEEN ADVISED OF THE POSSIBILITY OF SUCH </font>
00274 <font class="comment">DAMAGES.</font>
00275 <font class="comment"></font>
00276 <font class="comment">                     END OF TERMS AND CONDITIONS</font>
00277 <font class="comment">*/</font>
<a name="l00278"></a><a class="code" href="CSocket_8cpp.html#a1">00278</a> <font class="keyword">static</font> <font class="keyword">const</font> <font class="keywordtype">char</font>* <a class="code" href="CSocket_8cpp.html#a1">Copyright</a>= <font class="stringliteral">"(C) Copyright Michigan State University 2002, All rights reserved"</font>;
00302 <font class="comment">// Synchronization assumptions:</font>
00303 <font class="comment">//    the (2) socket calls are recursive (threadsafe).</font>
00304 <font class="comment">//    the (3) network database calls are not recursive (notthreadsafe).</font>
00305 <font class="comment">//  as such, any calls to (3) network database calls are bracketed with</font>
00306 <font class="comment">//  calls to globally synchronize the thread.</font>
00311 <font class="comment"></font>
00312 <font class="preprocessor">#include "<a class="code" href="CSocket_8h.html">CSocket.h</a>"</font>    
00313 <font class="preprocessor">#include &lt;<a class="code" href="CApplicationSerializer_8h.html">CApplicationSerializer.h</a>&gt;</font>
00314 
00315 <font class="comment">// Exception classes required:</font>
00316 
00317 <font class="preprocessor">#include &lt;<a class="code" href="CTCPNoSuchHost_8h.html">CTCPNoSuchHost.h</a>&gt;</font>
00318 <font class="preprocessor">#include &lt;<a class="code" href="CTCPNoSuchService_8h.html">CTCPNoSuchService.h</a>&gt;</font>
00319 <font class="preprocessor">#include &lt;<a class="code" href="CTCPBadSocketState_8h.html">CTCPBadSocketState.h</a>&gt;</font>
00320 <font class="preprocessor">#include &lt;<a class="code" href="CTCPConnectionFailed_8h.html">CTCPConnectionFailed.h</a>&gt;</font>
00321 <font class="preprocessor">#include &lt;ErrnoException.h&gt;</font>
00322 <font class="preprocessor">#include &lt;<a class="code" href="CTCPConnectionLost_8h.html">CTCPConnectionLost.h</a>&gt;</font>
00323 
00324 <font class="comment">// Standard and netork library headers.</font>
00325 
00326 <font class="preprocessor">#include &lt;stdio.h&gt;</font>
00327 <font class="preprocessor">#include &lt;sys/types.h&gt;</font>
00328 <font class="preprocessor">#include &lt;sys/socket.h&gt;</font>
00329 <font class="preprocessor">#include &lt;sys/time.h&gt;</font>
00330 <font class="preprocessor">#include &lt;netinet/in.h&gt;</font>
00331 <font class="preprocessor">#include &lt;arpa/inet.h&gt;</font>
00332 
00333 <font class="comment">// STL includes.</font>
00334 
00335 <font class="preprocessor">#include &lt;vector&gt;</font>                               
00336 
00337 <font class="comment">// Manifest constannts:</font>
00338 
00339 <font class="preprocessor">#ifndef TRUE</font>
00340 <font class="preprocessor"></font><font class="preprocessor">#define TRUE 1</font>
00341 <font class="preprocessor"></font><font class="preprocessor">#endif</font>
00342 <font class="preprocessor"></font><font class="preprocessor">#ifndef FALSE</font>
<a name="l00343"></a><a class="code" href="CSocket_8cpp.html#a0">00343</a> <font class="preprocessor"></font><font class="preprocessor">#define FALSE 0</font>
00344 <font class="preprocessor"></font><font class="preprocessor">#endif</font>
00345 <font class="preprocessor"></font>
00346 <font class="comment">// Static members:</font>
00347 
<a name="l00348"></a><a class="code" href="classCSocket.html#r0">00348</a> map&lt;CSocket::State, string&gt; <a class="code" href="classCSocket.html#r0">CSocket::m_StateNames</a>;
00349 
<a name="l00365"></a><a class="code" href="classCSocket.html#a0">00365</a> <a class="code" href="classCSocket.html#a0">CSocket::CSocket</a> ()
00366    : m_Fd(-1),
00367      m_State(Disconnected)
00368  
00369 {
00370   <a class="code" href="classCSocket.html#b4">OpenSocket</a>();
00371 } 
00372 
<a name="l00378"></a><a class="code" href="classCSocket.html#a2">00378</a> <a class="code" href="classCSocket.html#a2">CSocket::~CSocket</a> ( )  <font class="comment">//Destructor - Delete dynamic objects</font>
00379 {
00380   <font class="keywordflow">if</font>(m_State == Connected) {
00381     Shutdown();
00382   }
00383   <font class="keywordflow">if</font>(m_Fd &gt; 0) {
00384     close(m_Fd);
00385   }
00386 }
00387 
<a name="l00398"></a><a class="code" href="classCSocket.html#a1">00398</a> <a class="code" href="classCSocket.html#a0">CSocket::CSocket</a> (    <font class="keywordtype">int</font> am_Fd,  <a class="code" href="classCSocket.html#s4">CSocket::State</a> am_State  ) :
00399   m_Fd(am_Fd),
00400   m_State(am_State)
00401 
00402 {  
00403   <a class="code" href="classCSocket.html#e0">StockStateMap</a>();              <font class="comment">// Ensure the statename map is stocked.</font>
00404 } 
00405 
00406 <font class="comment">// Functions for class CSocket</font>
00407 
00442 <font class="keywordtype">void</font> 
<a name="l00443"></a><a class="code" href="classCSocket.html#a5">00443</a> <a class="code" href="classCSocket.html#a5">CSocket::Connect</a>(<font class="keyword">const</font> string&amp; host, <font class="keyword">const</font> string&amp; service)  
00444 { 
00445   <font class="comment">// We must be disconnected to do any of this...</font>
00446   
00447   vector&lt;CSocket::State&gt; allowedStates;
00448   allowedStates.push_back(<a class="code" href="classCSocket.html#s4s0">Disconnected</a>);
00449 
00450   <font class="keywordflow">if</font>(<a class="code" href="classCSocket.html#o1">m_State</a> != <a class="code" href="classCSocket.html#s4s0">Disconnected</a>) <font class="keywordflow">throw</font> <a class="code" href="classCTCPBadSocketState.html">CTCPBadSocketState</a>(<a class="code" href="classCSocket.html#o1">m_State</a>, allowedStates,
00451                                                     <font class="stringliteral">"CSocket::Connect"</font>);
00452 
00453   <font class="comment">// If the host is a dotted ip number just translate it.. otherwise</font>
00454   <font class="comment">// try to resolve the name:</font>
00455 
00456   <font class="keywordtype">unsigned</font> <font class="keywordtype">long</font> <font class="keywordtype">int</font> ipaddr;
00457   <font class="keyword">struct </font>hostent* pEntry;
00458 
00459     <a class="code" href="classCApplicationSerializer.html#d0">CApplicationSerializer::getInstance</a>()-&gt;<a class="code" href="classCThreadRecursiveMutex.html#a6">Lock</a>(); <font class="comment">// &lt;-- Critical region</font>
00460     {                                              <font class="comment">// (3) calls not threadsafe.</font>
00461       ipaddr = inet_addr(host.c_str());
00462       <font class="keywordflow">if</font>(ipaddr == INADDR_NONE) {       <font class="comment">// Need to translate the name...</font>
00463         pEntry = gethostbyname(host.c_str());
00464         <font class="keywordflow">if</font>(pEntry) memcpy(&amp;ipaddr, pEntry-&gt;h_addr, 4);
00465       }                                              <font class="comment">// &lt;-- End Critical region</font>
00466       <a class="code" href="classCApplicationSerializer.html#d0">CApplicationSerializer::getInstance</a>()-&gt;<a class="code" href="classCThreadRecursiveMutex.html#a7">UnLock</a>();
00467       <font class="keywordflow">if</font>(!pEntry) <font class="keywordflow">throw</font> <a class="code" href="classCTCPNoSuchHost.html">CTCPNoSuchHost</a>(host, 
00468                                        <font class="stringliteral">"Null return from gethostbyname(3)"</font>);
00469     }
00470   <font class="comment">// Next resolve the service name... this can be either a number or a </font>
00471   <font class="comment">// service name.  Note that the port number is in the service database</font>
00472   <font class="comment">// in network byte order.</font>
00473 
00474   <font class="keywordtype">unsigned</font> <font class="keywordtype">short</font> port = <a class="code" href="classCSocket.html#b2">Service</a>(service);
00475 
00476 
00477   <font class="comment">// Now we have everything we need to do call 'the other' Connect.</font>
00478 
00479   <a class="code" href="classCSocket.html#a5">Connect</a>(ntohl(ipaddr), ntohs(port));
00480 }  
00481 
00494 <font class="keywordtype">void</font> 
<a name="l00495"></a><a class="code" href="classCSocket.html#a6">00495</a> <a class="code" href="classCSocket.html#a5">CSocket::Connect</a>(<font class="keywordtype">unsigned</font> <font class="keywordtype">long</font> <font class="keywordtype">int</font> IpAddress, <font class="keywordtype">unsigned</font> <font class="keywordtype">short</font> service)
00496 
00497 {
00498   <font class="comment">// Must be disconnected:</font>
00499 
00500   vector&lt;CSocket::State&gt; allowedStates;
00501   allowedStates.push_back(<a class="code" href="classCSocket.html#s4s0">Disconnected</a>);
00502 
00503   <font class="keywordflow">if</font>(<a class="code" href="classCSocket.html#o1">m_State</a> != <a class="code" href="classCSocket.html#s4s0">Disconnected</a>) <font class="keywordflow">throw</font> <a class="code" href="classCTCPBadSocketState.html">CTCPBadSocketState</a>(<a class="code" href="classCSocket.html#o1">m_State</a>, allowedStates,
00504                                                     <font class="stringliteral">"CSocket::Connect"</font>);
00505 
00506   <font class="comment">// Both the ip address and service must be in network byte order to be </font>
00507   <font class="comment">// acceptable to connect(2).</font>
00508 
00509   IpAddress = htonl(IpAddress);
00510   service   = htons(service);
00511 
00512   <font class="comment">// Build the socket peer address structure.</font>
00513 
00514   sockaddr_in Peer;
00515   Peer.sin_port = service;
00516   memcpy(&amp;(Peer.sin_addr), &amp;IpAddress, <font class="keyword">sizeof</font>(<font class="keywordtype">unsigned</font> <font class="keywordtype">long</font> <font class="keywordtype">int</font>));
00517   Peer.sin_family = AF_INET;
00518 
00519   <font class="comment">// Try the connect.</font>
00520 
00521   <font class="keywordflow">if</font>(connect(<a class="code" href="classCSocket.html#o0">m_Fd</a>, (<font class="keyword">const</font> sockaddr*)&amp;Peer, <font class="keyword">sizeof</font>(sockaddr_in)) &lt; 0) {
00522     <font class="keywordtype">int</font> sErrno = errno;
00523     string Ip, Svc;
00524     <a class="code" href="classCApplicationSerializer.html#d0">CApplicationSerializer::getInstance</a>()-&gt;<a class="code" href="classCThreadRecursiveMutex.html#a6">Lock</a>(); <font class="comment">//&lt;-- Critical section start</font>
00525     {
00526       <font class="keywordtype">char</font> port[50];
00527       Ip = inet_ntoa(Peer.sin_addr);
00528       sprintf(port,<font class="stringliteral">"%d"</font>, ntohs(service));
00529       Svc  = port;
00530 
00531     }
00532     <a class="code" href="classCApplicationSerializer.html#d0">CApplicationSerializer::getInstance</a>()-&gt;<a class="code" href="classCThreadRecursiveMutex.html#a7">UnLock</a>(); <font class="comment">//&lt;-- End Crit. Section.</font>
00533     errno = sErrno;             <font class="comment">// sprintf e.g. destroys errno.</font>
00534     <font class="keywordflow">throw</font> <a class="code" href="classCTCPConnectionFailed.html">CTCPConnectionFailed</a>(Ip, Svc,
00535                                <font class="stringliteral">"CSocket::Connect client connect(2) failed"</font>);
00536   }
00537 
00538   <a class="code" href="classCSocket.html#o1">m_State</a> = <a class="code" href="classCSocket.html#s4s3">Connected</a>;
00539   
00540 
00541 }
00542 
00561 <font class="keywordtype">void</font> 
<a name="l00562"></a><a class="code" href="classCSocket.html#a7">00562</a> <a class="code" href="classCSocket.html#a7">CSocket::Bind</a>(<font class="keyword">const</font> string&amp; service)  
00563 { 
00564   vector&lt;CSocket::State&gt; allowedStates;
00565   allowedStates.push_back(<a class="code" href="classCSocket.html#s4s0">Disconnected</a>);
00566   <font class="keywordflow">if</font>(<a class="code" href="classCSocket.html#o1">m_State</a> != <a class="code" href="classCSocket.html#s4s0">Disconnected</a>) <font class="keywordflow">throw</font> <a class="code" href="classCTCPBadSocketState.html">CTCPBadSocketState</a>(<a class="code" href="classCSocket.html#o1">m_State</a>, allowedStates,
00567                                                        <font class="stringliteral">"CSocket::Bind"</font>);
00568 
00569   <font class="comment">// Determine the service in network byte order.</font>
00570 
00571   <font class="keywordtype">unsigned</font> <font class="keywordtype">short</font> port = <a class="code" href="classCSocket.html#b2">Service</a>(service);
00572 
00573 
00574   <font class="comment">// Now bind the socket.</font>
00575 
00576   sockaddr_in Peer;
00577   Peer.sin_port   = port;
00578   Peer.sin_family = AF_INET;
00579   Peer.sin_addr.s_addr = htonl(INADDR_ANY);
00580 
00581   <font class="keywordflow">if</font>(bind(<a class="code" href="classCSocket.html#o0">m_Fd</a>, (sockaddr*)&amp;Peer, <font class="keyword">sizeof</font>(sockaddr_in)) &lt; 0) {
00582     <font class="keywordflow">throw</font> <a class="code" href="classCErrnoException.html">CErrnoException</a>(<font class="stringliteral">"Error from bind(2) in CSocket::Bind()"</font>);
00583   }
00584   <a class="code" href="classCSocket.html#o1">m_State</a> = <a class="code" href="classCSocket.html#s4s1">Bound</a>;
00585 
00586 }  
00587 
00609 <font class="keywordtype">void</font> 
<a name="l00610"></a><a class="code" href="classCSocket.html#a8">00610</a> <a class="code" href="classCSocket.html#a8">CSocket::Listen</a>(<font class="keywordtype">unsigned</font> <font class="keywordtype">int</font> nBacklog)  
00611 { 
00612   <font class="comment">// Throw CTCPBadSocketState if not bound:</font>
00613 
00614   <font class="keywordflow">if</font>(<a class="code" href="classCSocket.html#o1">m_State</a> != <a class="code" href="classCSocket.html#s4s1">Bound</a>) {
00615     vector&lt;CSocket::State&gt; allowedStates;
00616     allowedStates.push_back(<a class="code" href="classCSocket.html#s4s1">Bound</a>);
00617     <font class="keywordflow">throw</font> <a class="code" href="classCTCPBadSocketState.html">CTCPBadSocketState</a>(<a class="code" href="classCSocket.html#o1">m_State</a>, allowedStates, 
00618                              <font class="stringliteral">"CSocket::Listen"</font>);
00619   }
00620   <font class="keywordflow">if</font>(listen(<a class="code" href="classCSocket.html#o0">m_Fd</a>, nBacklog) &lt; 0) 
00621     <font class="keywordflow">throw</font> <a class="code" href="classCErrnoException.html">CErrnoException</a>(<font class="stringliteral">"CSocket::Listen listen(2) failed"</font>);
00622 
00623   <a class="code" href="classCSocket.html#o1">m_State</a> = <a class="code" href="classCSocket.html#s4s2">Listening</a>;
00624 }  
00625 
00658 <a class="code" href="classCSocket.html">CSocket</a>*  
<a name="l00659"></a><a class="code" href="classCSocket.html#a9">00659</a> <a class="code" href="classCSocket.html#a9">CSocket::Accept</a>(string&amp; client)  
00660 { 
00661   <font class="comment">// Throw CTCPBadSocket if not listening.</font>
00662 
00663   <font class="keywordflow">if</font>(<a class="code" href="classCSocket.html#o1">m_State</a> != <a class="code" href="classCSocket.html#s4s2">Listening</a>) {
00664     vector&lt;CSocket::State&gt; allowedStates;
00665     allowedStates.push_back(<a class="code" href="classCSocket.html#s4s2">Listening</a>);
00666     <font class="keywordflow">throw</font> <a class="code" href="classCTCPBadSocketState.html">CTCPBadSocketState</a>(<a class="code" href="classCSocket.html#o1">m_State</a>, allowedStates,
00667                              <font class="stringliteral">"CSocket::Accept"</font>);
00668   }
00669   
00670   <font class="comment">// Attempt the accept.  If successfule, the return</font>
00671   <font class="comment">// value will be a socket fd.</font>
00672 
00673   <font class="keyword">struct </font>sockaddr_in peerInfo;
00674   socklen_t          addrlen(<font class="keyword">sizeof</font>(sockaddr_in));
00675   <font class="keywordtype">int</font> peerFd = accept(<a class="code" href="classCSocket.html#o0">m_Fd</a>, (sockaddr*)&amp;peerInfo, &amp;addrlen);
00676   <font class="keywordflow">if</font>(peerFd &lt; 0) {
00677     <font class="keywordflow">throw</font> <a class="code" href="classCErrnoException.html">CErrnoException</a>(<font class="stringliteral">"CSocket::Accept accept(2) failed"</font>);
00678   }
00679 
00680   <font class="comment">// At this time we have received a good connection. There are two things</font>
00681   <font class="comment">// we need to do:</font>
00682   <font class="comment">//   1. Construct a new CSocket in the connected state.</font>
00683   <font class="comment">//   2. Figure out and fill in the client:</font>
00684 
00685   <a class="code" href="classCSocket.html">CSocket</a>* pConnection = <font class="keyword">new</font> <a class="code" href="classCSocket.html#a0">CSocket</a>(peerFd, <a class="code" href="classCSocket.html#s4s3">Connected</a>);
00686   client = <a class="code" href="classCSocket.html#b3">AddressToHostString</a>(peerInfo.sin_addr);
00687 
00688   <font class="keywordflow">return</font> pConnection;
00689 }  
00690 
00707 <font class="keywordtype">void</font> 
<a name="l00708"></a><a class="code" href="classCSocket.html#a10">00708</a> <a class="code" href="classCSocket.html#a10">CSocket::Shutdown</a>()  
00709 { 
00710   <font class="comment">// Require that the socket be connected.</font>
00711 
00712   <font class="keywordflow">if</font>(<a class="code" href="classCSocket.html#o1">m_State</a> != <a class="code" href="classCSocket.html#s4s3">Connected</a>) {
00713     vector&lt;CSocket::State&gt; allowedStates;
00714     allowedStates.push_back(<a class="code" href="classCSocket.html#s4s3">Connected</a>);
00715     <font class="keywordflow">throw</font> <a class="code" href="classCTCPBadSocketState.html">CTCPBadSocketState</a>(<a class="code" href="classCSocket.html#o1">m_State</a>, allowedStates,
00716                              <font class="stringliteral">"CSocket::Shutdown"</font>);
00717   }
00718 
00719  
00720   <font class="keywordflow">if</font>(shutdown(<a class="code" href="classCSocket.html#o0">m_Fd</a>, SHUT_RDWR) &lt; 0) {
00721     <font class="keywordflow">throw</font> <a class="code" href="classCErrnoException.html">CErrnoException</a>(<font class="stringliteral">"CSocket::Shutdown failed in call to shutdown(2)"</font>);
00722   }
00723 
00724   <a class="code" href="classCSocket.html#o1">m_State</a> = <a class="code" href="classCSocket.html#s4s0">Disconnected</a>;
00725   close(<a class="code" href="classCSocket.html#o0">m_Fd</a>);
00726   <a class="code" href="classCSocket.html#o0">m_Fd</a> = -1;                    <font class="comment">// Mark the socket closed.</font>
00727 <a class="code" href="classCSocket.html#b4">OpenSocket</a>();
00728 }  
00729 
00748 <font class="keywordtype">int</font> 
<a name="l00749"></a><a class="code" href="classCSocket.html#a11">00749</a> <a class="code" href="classCSocket.html#a11">CSocket::Read</a>(<font class="keywordtype">void</font>* pBuffer, size_t nBytes)  
00750 { 
00751   <font class="comment">// Require the socket be connected:</font>
00752 
00753   <font class="keywordflow">if</font>(<a class="code" href="classCSocket.html#o1">m_State</a> != <a class="code" href="classCSocket.html#s4s3">Connected</a>) {
00754     vector&lt;CSocket::State&gt; allowedStates;
00755     allowedStates.push_back(<a class="code" href="classCSocket.html#s4s3">Connected</a>);
00756     <font class="keywordflow">throw</font> <a class="code" href="classCTCPBadSocketState.html">CTCPBadSocketState</a>(<a class="code" href="classCSocket.html#o1">m_State</a>, allowedStates,
00757                              <font class="stringliteral">"CSocket::Read()"</font>);
00758   }
00759   <font class="comment">// Attempt the read:</font>
00760 
00761   <font class="keywordtype">int</font> nB = read(<a class="code" href="classCSocket.html#o0">m_Fd</a>, pBuffer, nBytes);
00762   
00763   <font class="comment">// Check for EOF:</font>
00764 
00765   <font class="keywordflow">if</font>(nB == 0) {
00766     <a class="code" href="classCSocket.html#o1">m_State</a> = <a class="code" href="classCSocket.html#s4s0">Disconnected</a>;
00767     <font class="keywordflow">throw</font> <a class="code" href="classCTCPConnectionLost.html">CTCPConnectionLost</a>(<font class="keyword">this</font>, <font class="stringliteral">"CSocket::Read: from read(2)"</font>);
00768   }
00769   <font class="comment">// Check for error:</font>
00770 
00771   <font class="keywordflow">if</font>(nB &lt; 0) {
00772     <a class="code" href="classCSocket.html#o1">m_State</a> = <a class="code" href="classCSocket.html#s4s0">Disconnected</a>;
00773     <font class="keywordflow">throw</font> <a class="code" href="classCErrnoException.html">CErrnoException</a>(<font class="stringliteral">"CSocket::Read failed read(2)"</font>);
00774   }
00775   <font class="comment">// There's data to transfer.</font>
00776 
00777   <font class="keywordflow">return</font> nB;
00778 }  
00779 
00780 
00809 <font class="keywordtype">int</font> 
<a name="l00810"></a><a class="code" href="classCSocket.html#a12">00810</a> <a class="code" href="classCSocket.html#a12">CSocket::Write</a>(<font class="keywordtype">void</font>* pBuffer, size_t nBytes)  
00811 {
00812   <font class="comment">// Require that the socket is connected:</font>
00813 
00814   
00815 
00816   <font class="comment">// write(2) as many times as are needed to get the data out.</font>
00817 
00818 
00819   <font class="keywordtype">char</font>* p((<font class="keywordtype">char</font>* )pBuffer);     <font class="comment">// Pointer to current write.</font>
00820   <font class="keywordtype">int</font>   resid(nBytes);          <font class="comment">// Number of remaining bytes to write.</font>
00821   <font class="keywordtype">int</font>   nWritten(0);            <font class="comment">// Number  of bytes already written.</font>
00822 
00823   <font class="keywordflow">while</font>(resid) {
00824     <font class="keywordtype">int</font> n = write(<a class="code" href="classCSocket.html#o0">m_Fd</a>, p, resid);
00825     <font class="keywordflow">if</font>(n &gt; 0) {                 <font class="comment">// Do the book-keeping for a successful write.</font>
00826       resid    -= n;
00827       nWritten += n;
00828       p        += n;
00829     } 
00830     <font class="keywordflow">else</font> {                      <font class="comment">// Write failed:</font>
00831       <font class="keywordflow">if</font>(nWritten &gt; 0) {        <font class="comment">// Assume if not first write, additional</font>
00832         <font class="keywordflow">break</font>;                  <font class="comment">// Writes will give the same error.</font>
00833       }
00834       <font class="keywordflow">if</font>(errno == EPIPE) {      <font class="comment">// Disconnected.</font>
00835         <a class="code" href="classCSocket.html#o1">m_State</a> = <a class="code" href="classCSocket.html#s4s0">Disconnected</a>;
00836         <font class="keywordflow">throw</font> <a class="code" href="classCTCPConnectionLost.html">CTCPConnectionLost</a>(<font class="keyword">this</font>,<font class="stringliteral">"CSocket::Write - first write of loop"</font>);
00837       }
00838       <font class="keywordflow">else</font> {                    <font class="comment">// Some other error:</font>
00839         <a class="code" href="classCSocket.html#o1">m_State</a> = <a class="code" href="classCSocket.html#s4s0">Disconnected</a>;
00840         <font class="keywordflow">throw</font> <a class="code" href="classCErrnoException.html">CErrnoException</a>(<font class="stringliteral">"CSocket::Write failed write(2)"</font>);
00841       }
00842     }
00843   }
00844   <font class="keywordflow">return</font> nWritten;              <font class="comment">// Indicate how many bytes were actually</font>
00845                                 <font class="comment">// written. If &lt; nBytes something unusual</font>
00846                                 <font class="comment">// occured in the loop above.</font>
00847 }  
00848 
00869 <font class="keywordtype">void</font> 
<a name="l00870"></a><a class="code" href="classCSocket.html#a13">00870</a> <a class="code" href="classCSocket.html#a13">CSocket::getPeer</a>(<font class="keywordtype">unsigned</font> <font class="keywordtype">short</font>&amp;  port, string&amp; peer)  
00871 {
00872   <font class="comment">// Enforce connection requirement:</font>
00873 
00874   <font class="keywordflow">if</font>(<a class="code" href="classCSocket.html#o1">m_State</a> != <a class="code" href="classCSocket.html#s4s3">Connected</a>) {
00875     vector&lt;CSocket::State&gt; allowedStates;
00876     allowedStates.push_back(<a class="code" href="classCSocket.html#s4s3">Connected</a>);
00877     <font class="keywordflow">throw</font> <a class="code" href="classCTCPBadSocketState.html">CTCPBadSocketState</a>(<a class="code" href="classCSocket.html#o1">m_State</a>, allowedStates,
00878                              <font class="stringliteral">"CSocket::GetPeer"</font>);
00879   }
00880   <font class="comment">// Try the call to getpeername(2):</font>
00881 
00882   sockaddr_in PeerInfo;
00883   socklen_t   addrsize(<font class="keyword">sizeof</font>(sockaddr_in));
00884   <font class="keywordflow">if</font>(getpeername(<a class="code" href="classCSocket.html#o0">m_Fd</a>, (sockaddr*)&amp;PeerInfo, &amp;addrsize) &lt; 0) {
00885     <font class="keywordflow">throw</font> <a class="code" href="classCErrnoException.html">CErrnoException</a>(<font class="stringliteral">"CSocket::getPeer failed call to getpeername(2)"</font>);
00886   }
00887   <font class="comment">// Pull out the port in local host byte order, and translate the</font>
00888   <font class="comment">// ip address:</font>
00889 
00890   port = ntohs(PeerInfo.sin_port);
00891   peer = <a class="code" href="classCSocket.html#b3">AddressToHostString</a>(PeerInfo.sin_addr);
00892 
00893 }  
00894 
00915 <font class="keywordtype">void</font> 
<a name="l00916"></a><a class="code" href="classCSocket.html#a14">00916</a> <a class="code" href="classCSocket.html#a14">CSocket::OOBInline</a>(<font class="keywordtype">bool</font> State)  
00917 { 
00918   <font class="keywordtype">int</font> state((<font class="keywordtype">int</font>)<a class="code" href="classCSocket.html#s4">State</a>);
00919   <font class="keywordflow">if</font>(setsockopt(<a class="code" href="classCSocket.html#o0">m_Fd</a>, SOL_SOCKET, 
00920                 SO_OOBINLINE, (<font class="keywordtype">void</font>*)&amp;state, <font class="keyword">sizeof</font>(<font class="keywordtype">int</font>)) &lt; 0) {
00921     <font class="keywordflow">throw</font> <a class="code" href="classCErrnoException.html">CErrnoException</a>(<font class="stringliteral">"CSocket::OOBInline setsockopt(2) failed"</font>);
00922   }
00923 }  
00924 
00940 <font class="keywordtype">bool</font> 
<a name="l00941"></a><a class="code" href="classCSocket.html#a15">00941</a> <a class="code" href="classCSocket.html#a15">CSocket::isOOBInline</a>()  
00942 { 
00943   <font class="keywordtype">unsigned</font> <font class="keywordtype">int</font> state;
00944   socklen_t    size(<font class="keyword">sizeof</font>(<font class="keywordtype">int</font>));
00945   <font class="keywordflow">if</font>(getsockopt(<a class="code" href="classCSocket.html#o0">m_Fd</a>, SOL_SOCKET, 
00946                 SO_OOBINLINE, (<font class="keywordtype">void</font>*)&amp;state, &amp;size) &lt; 0) {
00947     <font class="keywordflow">throw</font> <a class="code" href="classCErrnoException.html">CErrnoException</a>(<font class="stringliteral">"CSocket::OOBInline getsockopt(2) failed"</font>);
00948   }
00949   <font class="keywordflow">return</font> state ? <a class="code" href="CSocket_8h.html#a0">TRUE</a> : <a class="code" href="CSocket_8cpp.html#a0">FALSE</a>;
00950 }  
00951 
00972 <font class="keywordtype">void</font> 
<a name="l00973"></a><a class="code" href="classCSocket.html#a16">00973</a> <a class="code" href="classCSocket.html#a16">CSocket::setRcvLowWaterMark</a>(size_t nBytes)  
00974 { 
00975   <font class="keywordflow">if</font>(setsockopt(<a class="code" href="classCSocket.html#o0">m_Fd</a>, SOL_SOCKET, SO_RCVLOWAT, (<font class="keywordtype">void</font>*)&amp;nBytes, <font class="keyword">sizeof</font>(size_t)) &lt; 0) {
00976     <font class="keywordflow">if</font> (errno == ENOPROTOOPT) {
00977       <font class="keywordflow">return</font>; <font class="comment">// Just not suppported is ok..</font>
00978     }
00979     <font class="keywordflow">throw</font> 
00980       <a class="code" href="classCErrnoException.html">CErrnoException</a>(<font class="stringliteral">"CSocket::setRcvLowWaterMark() setsockopt(2) failed"</font>);
00981   }
00982 }
00983 
00984 
00996 size_t 
<a name="l00997"></a><a class="code" href="classCSocket.html#a17">00997</a> <a class="code" href="classCSocket.html#a17">CSocket::getRcvLowWaterMark</a>()  
00998 { 
00999   <font class="keywordtype">int</font> nBytes;
01000   socklen_t addrlen(<font class="keyword">sizeof</font>(<font class="keywordtype">int</font>));
01001   <font class="keywordflow">if</font>(getsockopt(<a class="code" href="classCSocket.html#o0">m_Fd</a>, SOL_SOCKET, SO_RCVLOWAT, &amp;nBytes, &amp;addrlen) &lt; 0) {
01002     <font class="keywordflow">throw</font> 
01003       <a class="code" href="classCErrnoException.html">CErrnoException</a>(<font class="stringliteral">"CSocket::getRcvLowWaterMark() getsockopt(2) failed"</font>);
01004   }
01005   <font class="keywordflow">return</font> (size_t)nBytes;
01006 }  
01007 
01025 <font class="keywordtype">void</font> 
<a name="l01026"></a><a class="code" href="classCSocket.html#a18">01026</a> <a class="code" href="classCSocket.html#a18">CSocket::setSndLowWaterMark</a>(size_t nBytes)  
01027 { 
01028   <font class="keywordflow">if</font>(setsockopt(<a class="code" href="classCSocket.html#o0">m_Fd</a>, SOL_SOCKET, SO_SNDLOWAT, &amp;nBytes, <font class="keyword">sizeof</font>(size_t)) &lt; 0) {
01029     <font class="keywordflow">if</font> (errno != ENOPROTOOPT) {
01030       <a class="code" href="classCErrnoException.html">CErrnoException</a>(<font class="stringliteral">"CSocket::setSndLowWaterMark() setsockopt(2) failed"</font>);
01031     }
01032   }  
01033 }
01043 size_t 
<a name="l01044"></a><a class="code" href="classCSocket.html#a19">01044</a> <a class="code" href="classCSocket.html#a19">CSocket::getSndLowWaterMark</a>()  
01045 {
01046   <font class="keywordtype">int</font> nBytes;
01047   socklen_t adrlen(<font class="keyword">sizeof</font>(<font class="keywordtype">int</font>));
01048   <font class="keywordflow">if</font>(getsockopt(<a class="code" href="classCSocket.html#o0">m_Fd</a>, SOL_SOCKET, SO_SNDLOWAT, &amp;nBytes, &amp;adrlen) &lt; 0) {
01049     <font class="keywordflow">throw</font> 
01050       <a class="code" href="classCErrnoException.html">CErrnoException</a>(<font class="stringliteral">"CSocket::getRcvLowWaterMark() getsockopt(2) failed"</font>);
01051   }
01052   <font class="keywordflow">return</font> (size_t)nBytes; 
01053 }  
01054 
01066 <font class="keywordtype">void</font> 
<a name="l01067"></a><a class="code" href="classCSocket.html#a20">01067</a> <a class="code" href="classCSocket.html#a20">CSocket::setRcvTimeout</a>(<font class="keywordtype">unsigned</font> <font class="keywordtype">int</font> nMs)  
01068 { 
01069   <font class="comment">//</font>
01070   <font class="comment">// First convert the nMs parameter into a timeval.</font>
01071   <font class="comment">//</font>
01072   timeval timeout;
01073   timeout.tv_sec  = nMs / 1000;          <font class="comment">// Number of seconds...</font>
01074   timeout.tv_usec = (nMs % 1000) * 1000; <font class="comment">// Left over milliseconds in uSec.</font>
01075 
01076   <font class="comment">// Now make the request:</font>
01077 
01078   <font class="keywordflow">if</font>(setsockopt(<a class="code" href="classCSocket.html#o0">m_Fd</a>, SOL_SOCKET, SO_RCVTIMEO, 
01079                 &amp;timeout, <font class="keyword">sizeof</font>(timeval)) &lt; 0) {
01080     <font class="keywordflow">if</font>(errno != ENOPROTOOPT) {
01081       <font class="keywordflow">throw</font> <a class="code" href="classCErrnoException.html">CErrnoException</a>(<font class="stringliteral">"CSocket::setRcvTimeout setsockopt(2) failed"</font>);
01082     }
01083   }
01084 }  
01085 
01097 <font class="keywordtype">unsigned</font> <font class="keywordtype">int</font> 
<a name="l01098"></a><a class="code" href="classCSocket.html#a21">01098</a> <a class="code" href="classCSocket.html#a21">CSocket::getRcvTimeout</a>()  
01099 { 
01100   timeval timeout;
01101   socklen_t adrlen(<font class="keyword">sizeof</font>(timeval));
01102   
01103   <font class="comment">// Get the timeout if possible: </font>
01104 
01105   <font class="keywordflow">if</font>(getsockopt(<a class="code" href="classCSocket.html#o0">m_Fd</a>, SOL_SOCKET, SO_RCVTIMEO, 
01106                 &amp;timeout, &amp;adrlen) &lt; 0) {
01107     <font class="keywordflow">throw</font> <a class="code" href="classCErrnoException.html">CErrnoException</a>(<font class="stringliteral">"CSocket::getRcvTimeout getsockopt(2) failed"</font>);
01108   }
01109   <font class="comment">// Convert to ms and return.</font>
01110 
01111   <font class="keywordtype">int</font> nMs = timeout.tv_sec*1000; + timeout.tv_usec/1000000;
01112   <font class="keywordflow">return</font> nMs;
01113 }  
01114 
01130 <font class="keywordtype">void</font> 
<a name="l01131"></a><a class="code" href="classCSocket.html#a22">01131</a> <a class="code" href="classCSocket.html#a22">CSocket::setSndTimeout</a>(<font class="keywordtype">unsigned</font> <font class="keywordtype">int</font> nMs)  
01132 { 
01133   <font class="comment">// Convert timeout to a timeval structure:</font>
01134 
01135   timeval timeout;
01136   timeout.tv_sec  = nMs / 1000;          <font class="comment">// Number of seconds...</font>
01137   timeout.tv_usec = (nMs % 1000) * 1000; <font class="comment">// Left over milliseconds in uSec.</font>
01138 
01139   <font class="comment">// Now make the request:</font>
01140 
01141   <font class="keywordflow">if</font>(setsockopt(<a class="code" href="classCSocket.html#o0">m_Fd</a>, SOL_SOCKET, SO_SNDTIMEO, 
01142                 &amp;timeout, <font class="keyword">sizeof</font>(timeval)) &lt; 0) {
01143     <font class="keywordflow">if</font>(errno != ENOPROTOOPT) {
01144       <font class="keywordflow">throw</font> <a class="code" href="classCErrnoException.html">CErrnoException</a>(<font class="stringliteral">"CSocket::setRcvTimeout setsockopt(2) failed"</font>);
01145     }
01146   }
01147 }  
01148 
01158 <font class="keywordtype">unsigned</font> <font class="keywordtype">int</font> 
<a name="l01159"></a><a class="code" href="classCSocket.html#a23">01159</a> <a class="code" href="classCSocket.html#a23">CSocket::getSndTimeout</a>()  
01160 { 
01161   timeval timeout;
01162   socklen_t adrlen(<font class="keyword">sizeof</font>(timeval));
01163   
01164   <font class="comment">// Get the timeout if possible: </font>
01165 
01166   <font class="keywordflow">if</font>(getsockopt(<a class="code" href="classCSocket.html#o0">m_Fd</a>, SOL_SOCKET, SO_SNDTIMEO, 
01167                 &amp;timeout, &amp;adrlen) &lt; 0) {
01168     <font class="keywordflow">throw</font> <a class="code" href="classCErrnoException.html">CErrnoException</a>(<font class="stringliteral">"CSocket::getRcvTimeout getsockopt(2) failed"</font>);
01169   }
01170   <font class="comment">// Convert to ms and return.</font>
01171 
01172   <font class="keywordtype">int</font> nMs = timeout.tv_sec*1000; + timeout.tv_usec/1000000;
01173   <font class="keywordflow">return</font> nMs;
01174 }  
01175 
01192 <font class="keywordtype">void</font> 
<a name="l01193"></a><a class="code" href="classCSocket.html#a24">01193</a> <a class="code" href="classCSocket.html#a24">CSocket::Debug</a>(<font class="keywordtype">bool</font> fState=<a class="code" href="CSocket_8h.html#a0">TRUE</a>)  
01194 {
01195   <font class="keywordtype">int</font> state((<font class="keywordtype">int</font>)fState);
01196   <font class="keywordflow">if</font>(setsockopt(<a class="code" href="classCSocket.html#o0">m_Fd</a>, SOL_SOCKET, SO_DEBUG, &amp;state, <font class="keyword">sizeof</font>(<font class="keywordtype">int</font>)) &lt; 0) {
01197     <font class="keywordflow">throw</font> <a class="code" href="classCErrnoException.html">CErrnoException</a>(<font class="stringliteral">"CSocket::Debug setsockopt(2) failed"</font>);
01198   }
01199 
01200 }  
01201 
01213 <font class="keywordtype">bool</font> 
<a name="l01214"></a><a class="code" href="classCSocket.html#a25">01214</a> <a class="code" href="classCSocket.html#a25">CSocket::isDebug</a>()  
01215 { 
01216   <font class="keywordtype">int</font> fstate;
01217   socklen_t adrlen(<font class="keyword">sizeof</font>(<font class="keywordtype">int</font>));
01218   <font class="keywordflow">if</font>(getsockopt(<a class="code" href="classCSocket.html#o0">m_Fd</a>, SOL_SOCKET, SO_DEBUG, &amp;fstate, &amp;adrlen) &lt; 0) {
01219     <font class="keywordflow">throw</font> <a class="code" href="classCErrnoException.html">CErrnoException</a>(<font class="stringliteral">"CSocket:Debug getsockopt(2) failed"</font>);
01220   }
01221   <font class="keywordflow">return</font> fstate ? <a class="code" href="CSocket_8h.html#a0">TRUE</a> : <a class="code" href="CSocket_8cpp.html#a0">FALSE</a>;
01222 }  
01223 
01246 <font class="keywordtype">void</font> 
<a name="l01247"></a><a class="code" href="classCSocket.html#a26">01247</a> <a class="code" href="classCSocket.html#a26">CSocket::SetNotRoutable</a>(<font class="keywordtype">bool</font> fRoutable)  
01248 { 
01249   <font class="keywordtype">int</font> state((<font class="keywordtype">int</font>)fRoutable);
01250   <font class="keywordflow">if</font>(setsockopt(<a class="code" href="classCSocket.html#o0">m_Fd</a>, SOL_SOCKET, SO_DONTROUTE, &amp;state, <font class="keyword">sizeof</font>(<font class="keywordtype">int</font>)) &lt; 0) {
01251     <font class="keywordflow">throw</font> <a class="code" href="classCErrnoException.html">CErrnoException</a>(<font class="stringliteral">"CSocket::SetNotRoutable setsockopt(2) failed"</font>);
01252   }
01253 
01254 }  
01255 
01271 <font class="keywordtype">bool</font> 
<a name="l01272"></a><a class="code" href="classCSocket.html#a27">01272</a> <a class="code" href="classCSocket.html#a27">CSocket::isNotRoutable</a>()  
01273 { 
01274   <font class="keywordtype">int</font> fState;
01275   socklen_t adrlen(<font class="keyword">sizeof</font>(<font class="keywordtype">int</font>));
01276   <font class="keywordflow">if</font>(getsockopt(<a class="code" href="classCSocket.html#o0">m_Fd</a>, SOL_SOCKET, SO_DONTROUTE, &amp;fState, &amp;adrlen) &lt; 0) {
01277     <font class="keywordflow">throw</font> <a class="code" href="classCErrnoException.html">CErrnoException</a>(<font class="stringliteral">"CSocket::isNotRoutable getsockopt(2) failed"</font>);
01278   }
01279   <font class="keywordflow">return</font> fState ? <a class="code" href="CSocket_8h.html#a0">TRUE</a> : <a class="code" href="CSocket_8cpp.html#a0">FALSE</a>;
01280 }  
01281 
01304 <font class="keywordtype">void</font> 
<a name="l01305"></a><a class="code" href="classCSocket.html#a28">01305</a> <a class="code" href="classCSocket.html#a28">CSocket::setSndBufSize</a>(size_t nBufferSize)  
01306 { 
01307   <font class="keywordtype">unsigned</font> <font class="keywordtype">int</font> size((<font class="keywordtype">unsigned</font> <font class="keywordtype">int</font>)nBufferSize);
01308   <font class="keywordflow">if</font>(setsockopt(<a class="code" href="classCSocket.html#o0">m_Fd</a>, SOL_SOCKET, SO_SNDBUF, &amp;size, <font class="keyword">sizeof</font>(<font class="keywordtype">int</font>)) &lt; 0) {
01309     <font class="keywordflow">throw</font> <a class="code" href="classCErrnoException.html">CErrnoException</a>(<font class="stringliteral">"CSocket::setSndBufSize setsockopt(2) failed"</font>);
01310   }
01311 }  
01312 
01325 size_t 
<a name="l01326"></a><a class="code" href="classCSocket.html#a29">01326</a> <a class="code" href="classCSocket.html#a29">CSocket::getSndBufSize</a>()  
01327 { 
01328   <font class="keywordtype">unsigned</font> <font class="keywordtype">int</font> size;
01329   socklen_t    adrlen(<font class="keyword">sizeof</font>(<font class="keywordtype">int</font>));
01330   <font class="keywordflow">if</font>(getsockopt(<a class="code" href="classCSocket.html#o0">m_Fd</a>, SOL_SOCKET, SO_SNDBUF, &amp;size, &amp;adrlen) &lt; 0) {
01331     <font class="keywordflow">throw</font> <a class="code" href="classCErrnoException.html">CErrnoException</a>(<font class="stringliteral">"CSocket::getSndBufSize getsockopt(2) failed"</font>);
01332   }
01333   <font class="keywordflow">return</font> (size_t)size;
01334 }  
01335 
01352 <font class="keywordtype">void</font> 
<a name="l01353"></a><a class="code" href="classCSocket.html#a30">01353</a> <a class="code" href="classCSocket.html#a30">CSocket::setRcvBufSize</a>(size_t nBytes)  
01354 {
01355   <font class="keywordtype">unsigned</font> <font class="keywordtype">int</font> size = (<font class="keywordtype">unsigned</font> <font class="keywordtype">int</font>)nBytes;
01356  
01357   <font class="keywordflow">if</font>(setsockopt(<a class="code" href="classCSocket.html#o0">m_Fd</a>, SOL_SOCKET, SO_RCVBUF, &amp;size, <font class="keyword">sizeof</font>(<font class="keywordtype">int</font>)) &lt; 0) {
01358     <font class="keywordflow">throw</font> <a class="code" href="classCErrnoException.html">CErrnoException</a>(<font class="stringliteral">"CSocket::setRcvBufSize setsockopt(2) failed"</font>);
01359   }
01360 }  
01361 
01374 size_t 
<a name="l01375"></a><a class="code" href="classCSocket.html#a31">01375</a> <a class="code" href="classCSocket.html#a31">CSocket::getRcvBufSize</a>()  
01376 { 
01377   <font class="keywordtype">unsigned</font> <font class="keywordtype">int</font> size;
01378   socklen_t    adrlen(<font class="keyword">sizeof</font>(<font class="keywordtype">int</font>));
01379   <font class="keywordflow">if</font>(getsockopt(<a class="code" href="classCSocket.html#o0">m_Fd</a>, SOL_SOCKET, SO_RCVBUF, &amp;size, &amp;adrlen) &lt; 0) {
01380     <font class="keywordflow">throw</font> <a class="code" href="classCErrnoException.html">CErrnoException</a>(<font class="stringliteral">"CSocket::getSndBufSize getsockopt(2) failed"</font>);
01381   }
01382   <font class="keywordflow">return</font> (size_t)size;
01383 }  
01384 
01406 <font class="keywordtype">void</font> 
<a name="l01407"></a><a class="code" href="classCSocket.html#a32">01407</a> <a class="code" href="classCSocket.html#a32">CSocket::setLinger</a>(<font class="keywordtype">bool</font> lOn, <font class="keywordtype">int</font> nLingerSeconds)  
01408 { 
01409   <font class="comment">// The linger structure is filled in the way it is so that the user could</font>
01410   <font class="comment">// conceivably omit a timeout interval if lOn == FALSE since in that case,</font>
01411   <font class="comment">// nLingerSeconds won't be referenced.</font>
01412 
01413   linger lInfo;
01414   lInfo.l_onoff = lOn;
01415   <font class="keywordflow">if</font>(lOn) lInfo.l_linger = nLingerSeconds;
01416 
01417   <font class="comment">// Set the linger parameters:</font>
01418 
01419   <font class="keywordflow">if</font>(setsockopt(<a class="code" href="classCSocket.html#o0">m_Fd</a>, SOL_SOCKET, SO_LINGER, &amp;lInfo, <font class="keyword">sizeof</font>(linger)) &lt; 0) {
01420     <font class="keywordflow">throw</font> <a class="code" href="classCErrnoException.html">CErrnoException</a>(<font class="stringliteral">"CSocket::setLinger setsockopt(2) failed"</font>);
01421   }
01422 }  
01423 
01440 <font class="keywordtype">void</font> 
<a name="l01441"></a><a class="code" href="classCSocket.html#a33">01441</a> <a class="code" href="classCSocket.html#a33">CSocket::getLinger</a>(<font class="keywordtype">bool</font>&amp; isLingering, <font class="keywordtype">int</font>&amp; nLingerSeconds)  
01442 { 
01443   linger linfo;
01444   socklen_t addrlen(<font class="keyword">sizeof</font>(linger));
01445     <font class="keywordflow">if</font>(getsockopt(<a class="code" href="classCSocket.html#o0">m_Fd</a>, SOL_SOCKET, SO_LINGER, &amp;linfo, &amp;addrlen) &lt; 0) {
01446       <font class="keywordflow">throw</font> <a class="code" href="classCErrnoException.html">CErrnoException</a>(<font class="stringliteral">"CSocket::getLinger getsockopt(2) failed"</font>);
01447     }
01448 
01449   <font class="comment">// Fill in the parameters from the linger structure:</font>
01450 
01451   isLingering    = linfo.l_onoff;
01452   nLingerSeconds = linfo.l_linger; 
01453 }
01465 <font class="keywordtype">unsigned</font> <font class="keywordtype">short</font>
<a name="l01466"></a><a class="code" href="classCSocket.html#b2">01466</a> <a class="code" href="classCSocket.html#b2">CSocket::Service</a>(<font class="keyword">const</font> string&amp; rService)
01467 {
01468   <font class="keywordtype">unsigned</font> <font class="keywordtype">short</font> port;
01469   <font class="keywordtype">int</font>           nport;
01470 
01471   <font class="keywordflow">if</font>(sscanf(rService.c_str(), <font class="stringliteral">"%d"</font>, &amp;nport) != 1) { <font class="comment">// Non numeric service number.</font>
01472     <font class="keyword">struct </font>servent* pEntry;
01473     <a class="code" href="classCApplicationSerializer.html#d0">CApplicationSerializer::getInstance</a>()-&gt;<a class="code" href="classCThreadRecursiveMutex.html#a6">Lock</a>(); <font class="comment">// &lt;-- Critical region</font>
01474     {                                              <font class="comment">//  getservbyname not recursive</font>
01475       pEntry = getservbyname(rService.c_str(), <font class="stringliteral">"tcp"</font>);
01476       <font class="keywordflow">if</font>(pEntry) port = pEntry-&gt;s_port;
01477     }
01478     <a class="code" href="classCApplicationSerializer.html#d0">CApplicationSerializer::getInstance</a>()-&gt;<a class="code" href="classCThreadRecursiveMutex.html#a7">UnLock</a>(); <font class="comment">// &lt;-- End critical rgn.</font>
01479     <font class="keywordflow">if</font>(!pEntry) <font class="keywordflow">throw</font> <a class="code" href="classCTCPNoSuchService.html">CTCPNoSuchService</a>(rService, 
01480                                      <font class="stringliteral">"Null return from getservbyname(3)"</font>);
01481   }
01482   <font class="keywordflow">else</font> {
01483     port = nport;
01484     port = htons(port);
01485   }
01486   <font class="keywordflow">return</font> port;
01487 }
01488 
01502 string
<a name="l01503"></a><a class="code" href="classCSocket.html#b3">01503</a> <a class="code" href="classCSocket.html#b3">CSocket:: AddressToHostString</a>(in_addr peer)
01504 {
01505   string result;
01506   <a class="code" href="classCApplicationSerializer.html#d0">CApplicationSerializer::getInstance</a>()-&gt;<a class="code" href="classCThreadRecursiveMutex.html#a6">Lock</a>(); <font class="comment">// &lt;-- Critical Region.</font>
01507   {
01508     <font class="keyword">struct </font>hostent* pEntry = gethostbyaddr((<font class="keyword">const</font> <font class="keywordtype">char</font>*)&amp;peer, 
01509                                            <font class="keyword">sizeof</font>(in_addr), AF_INET);
01510     <font class="keywordflow">if</font>(pEntry) {                <font class="comment">// Reverse DNS worked...</font>
01511       result = pEntry-&gt;h_name;
01512       
01513     }
01514     <font class="keywordflow">else</font> {                      <font class="comment">// Need to return dotted address.</font>
01515       result = inet_ntoa(peer);
01516     }
01517   }
01518   <a class="code" href="classCApplicationSerializer.html#d0">CApplicationSerializer::getInstance</a>()-&gt;<a class="code" href="classCThreadRecursiveMutex.html#a7">UnLock</a>(); <font class="comment">// &lt;-- End Critical Region.</font>
01519 
01520   <font class="keywordflow">return</font> result;
01521 }
01531 string
<a name="l01532"></a><a class="code" href="classCSocket.html#d0">01532</a> <a class="code" href="classCSocket.html#d0">CSocket::StateName</a>(<a class="code" href="classCSocket.html#s4">CSocket::State</a> state)
01533 {
01534   <a class="code" href="classCSocket.html#e0">StockStateMap</a>();
01535   <font class="keywordflow">return</font> <a class="code" href="classCSocket.html#r0">m_StateNames</a>[state];
01536 }
01543 <font class="keywordtype">void</font> 
<a name="l01544"></a><a class="code" href="classCSocket.html#e0">01544</a> <a class="code" href="classCSocket.html#e0">CSocket::StockStateMap</a>()
01545 {
01546   <font class="keywordflow">if</font>(!<a class="code" href="classCSocket.html#r0">m_StateNames</a>.empty()) {
01547     <a class="code" href="classCSocket.html#r0">m_StateNames</a>[<a class="code" href="classCSocket.html#s4s0">Disconnected</a>] = <font class="stringliteral">"Disconnected"</font>;
01548     <a class="code" href="classCSocket.html#r0">m_StateNames</a>[<a class="code" href="classCSocket.html#s4s1">Bound</a>]        = <font class="stringliteral">"Bound"</font>;
01549     <a class="code" href="classCSocket.html#r0">m_StateNames</a>[<a class="code" href="classCSocket.html#s4s2">Listening</a>]    = <font class="stringliteral">"Listening"</font>;
01550     <a class="code" href="classCSocket.html#r0">m_StateNames</a>[<a class="code" href="classCSocket.html#s4s3">Connected</a>]    = <font class="stringliteral">"Connected"</font>;
01551   }
01552 }
01556 <font class="keywordtype">void</font>
<a name="l01557"></a><a class="code" href="classCSocket.html#b4">01557</a> <a class="code" href="classCSocket.html#b4">CSocket::OpenSocket</a>()
01558 {
01559   <font class="keywordtype">int</font>             protocol;
01560   <font class="keyword">struct </font>protoent* pEntry;
01561   <a class="code" href="classCSocket.html#e0">StockStateMap</a>();              <font class="comment">// Ensure the state name map is stocked.</font>
01562 
01563   <a class="code" href="classCApplicationSerializer.html#d0">CApplicationSerializer::getInstance</a>()-&gt;<a class="code" href="classCThreadRecursiveMutex.html#a6">Lock</a>(); <font class="comment">//--&gt; Critical region since</font>
01564   {                                            <font class="comment">// getprotoent not recursive.</font>
01565     <font class="keyword">struct </font>protoent* pEntry = getprotobyname(<font class="stringliteral">"TCP"</font>);
01566     <font class="keywordflow">if</font>(pEntry) protocol = pEntry-&gt;p_proto;
01567   }                                            <font class="comment">// &lt;-- End Critical Region.</font>
01568   <a class="code" href="classCApplicationSerializer.html#d0">CApplicationSerializer::getInstance</a>()-&gt;<a class="code" href="classCThreadRecursiveMutex.html#a7">UnLock</a>();
01569 
01570   <font class="keywordflow">if</font>(!pEntry) <font class="keywordflow">throw</font> 
01571               <a class="code" href="classCErrnoException.html">CErrnoException</a>(<font class="stringliteral">"Getting TCP protocol num from getprotoent(3)"</font>);
01572 
01573   <a class="code" href="classCSocket.html#o0">m_Fd</a> = socket(PF_INET, SOCK_STREAM, protocol);
01574   <font class="keywordflow">if</font>(<a class="code" href="classCSocket.html#o0">m_Fd</a> == -1) <font class="keywordflow">throw</font>
01575                    <a class="code" href="classCErrnoException.html">CErrnoException</a>(<font class="stringliteral">"Creating socket with socket(2)"</font>);
01576 
01577 }
</pre></div><hr><address align="right"><small>Generated on Tue Feb 4 12:34:54 2003 for Spectrodaq External Event Framework by
<a href="http://www.doxygen.org/index.html">
<img src="doxygen.png" alt="doxygen" align="middle" border=0 
width=110 height=53></a>1.2.15 </small></address>
</body>
</html>

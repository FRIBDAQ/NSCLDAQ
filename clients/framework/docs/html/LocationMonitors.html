<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.0 Transitional//EN">
<html><head><meta http-equiv="Content-Type" content="text/html;charset=iso-8859-1">
<title>Location monitors.</title>
<link href="doxygen.css" rel="stylesheet" type="text/css">
</head><body>
<!-- Generated by Doxygen 1.2.15 -->
<center>
<a class="qindex" href="main.html">Main Page</a> &nbsp; <a class="qindex" href="namespaces.html">Namespace List</a> &nbsp; <a class="qindex" href="hierarchy.html">Class Hierarchy</a> &nbsp; <a class="qindex" href="classes.html">Alphabetical List</a> &nbsp; <a class="qindex" href="annotated.html">Compound List</a> &nbsp; <a class="qindex" href="files.html">File List</a> &nbsp; <a class="qindex" href="functions.html">Compound Members</a> &nbsp; <a class="qindex" href="globals.html">File Members</a> &nbsp; <a class="qindex" href="pages.html">Related Pages</a> &nbsp; </center>
<hr><a name="LocationMonitors"><h2>Location monitors.</h2></a>

<p>
A location monitor watches a volatile memory location and, with low latency, dispatches to application code whenever a significant change in the monitored location occurs. A typical use of a location monitor would be to spin while monitoring a hardware register for changes indicating an event trigger.
<p>
The application framework encapsulates location monitors in a templated class: <a class="el" href="classCLocationEvent.html">CLocationEvent</a>. The implementation of this event is a thread which spins tightly on the location.
<p>
For each pass through the the main loop of <a class="el" href="classCLocationEvent.html">CLocationEvent</a>, the location is  tested for significant change. If a significant change ocured, the OnEvent member is called (<a class="el" href="classCEvent.html#b2">CLocationEvent::OnEvent</a>).
<p>
The concept of "significant change" is captured by associating a  <a class="el" href="classCPointerPredicate.html">CPointerPredicate</a> derived class with each location monitor. Predicates are  function like objects (they are objects from classes which implement  operator()), whose function call operator returns a boolean given the current value of the monitored location. The predicate determines if the change was significate from the application's standpoint and if so returns TRUE, otherwise FALSE.
<p>
The following pre-defined predicates exist:<ul>
<li><a class="el" href="classCChangedPredicate.html">CChangedPredicate</a> - The location's value this pass through the loop is  different than the prior pass.<li><a class="el" href="classCMaskedValuePredicate.html">CMaskedValuePredicate</a> - does a bitwise and of the location with a mask and compares the result to a value, equality indicates significance.</ul>
The example below is somewhat artificial. A location monitor is created to monitor an ordinary program memory location, using the <a class="el" href="classCChangedPredicate.html">CChangedPredicate</a> to  determine significant change. The main program accepts input from stdin, and modifies the location each time input is received.
<p>
The location monitor responds to the change by printing out the value of the location.
<p>
<div class="fragment"><pre><font class="preprocessor">#include &lt;spectrodaq.h&gt;</font>
<font class="preprocessor">#include &lt;<a class="code" href="SpectroFramework_8h.html">SpectroFramework.h</a>&gt;</font>

<font class="preprocessor">#include &lt;iostream.h&gt;</font>

<font class="keyword">volatile</font> <font class="keywordtype">long</font> location = 0;     <font class="comment">// Location monitored.</font>

<font class="keyword">typedef</font> <a class="code" href="classCLocationEvent.html">CLocationEvent&lt;long&gt;</a> LongMonitor;
<font class="keyword">typedef</font> <a class="code" href="classCPointerPredicate.html">CPointerPredicate&lt;long&gt;</a> LongPred;
<font class="keyword">typedef</font> <a class="code" href="classCChangedPredicate.html">CChangedPredicate&lt;long&gt;</a> LongChanged;

<font class="keyword">class </font>MyLocation : <font class="keyword">public</font> LongMonitor
{
<font class="keyword">public</font>:
  MyLocation(<font class="keyword">const</font> <font class="keywordtype">char</font>* pName, LongPred&amp; pred, <font class="keywordtype">long</font>* pLoc); <font class="comment">//  Constructor.</font>
  <font class="keyword">virtual</font> <font class="keywordtype">void</font> OnLocationChanged(<font class="keywordtype">long</font> newval);

};

MyLocation::MyLocation(<font class="keyword">const</font> <font class="keywordtype">char</font>* pName, LongPred&amp; pred,  <font class="keywordtype">long</font>* pLoc) :
  LongMonitor(pName, pLoc,  pred)
{
}
<font class="keywordtype">void</font>
MyLocation::OnLocationChanged(<font class="keywordtype">long</font> newval)
{
  cout &lt;&lt; <font class="stringliteral">"Location changed. New value is: "</font> &lt;&lt; newval &lt;&lt;endl;
}


<font class="keyword">class </font>MyApp : <font class="keyword">public</font> DAQROCNode
{
<font class="keyword">protected</font>:
  <font class="keywordtype">int</font> operator()(<font class="keywordtype">int</font> argc, <font class="keywordtype">char</font>** argv);
};

MyApp theApp;

<font class="keywordtype">int</font>
MyApp::operator()(<font class="keywordtype">int</font> argc, <font class="keywordtype">char</font>** argv)
{
  LongChanged predicate(location);
  MyLocation LocMonitor(<font class="stringliteral">"TriggeronChanged"</font>, predicate, (<font class="keywordtype">long</font>*)&amp;location);

  LocMonitor.Enable();

  cout &lt;&lt; <font class="stringliteral">" Location event: "</font> &lt;&lt; LocMonitor.DescribeSelf() &lt;&lt; endl;
  cout &lt;&lt; <font class="stringliteral">"Started\n"</font>;

  string input;
  <font class="keywordflow">while</font>(1) {
    cin &gt;&gt; input;               <font class="comment">//  Block until input...</font>
    location++;                 <font class="comment">// Update location.</font>
  }
}
</pre></div>
<p>
<hr><address align="right"><small>Generated on Wed Feb 5 13:40:37 2003 for Spectrodaq External Event Framework by
<a href="http://www.doxygen.org/index.html">
<img src="doxygen.png" alt="doxygen" align="middle" border=0 
width=110 height=53></a>1.2.15 </small></address>
</body>
</html>

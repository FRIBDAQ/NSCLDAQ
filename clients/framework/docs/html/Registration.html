<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.0 Transitional//EN">
<html><head><meta http-equiv="Content-Type" content="text/html;charset=iso-8859-1">
<title>Object Registries names and descriptions.</title>
<link href="doxygen.css" rel="stylesheet" type="text/css">
</head><body>
<!-- Generated by Doxygen 1.2.15 -->
<center>
<a class="qindex" href="main.html">Main Page</a> &nbsp; <a class="qindex" href="namespaces.html">Namespace List</a> &nbsp; <a class="qindex" href="hierarchy.html">Class Hierarchy</a> &nbsp; <a class="qindex" href="classes.html">Alphabetical List</a> &nbsp; <a class="qindex" href="annotated.html">Compound List</a> &nbsp; <a class="qindex" href="files.html">File List</a> &nbsp; <a class="qindex" href="functions.html">Compound Members</a> &nbsp; <a class="qindex" href="globals.html">File Members</a> &nbsp; <a class="qindex" href="pages.html">Related Pages</a> &nbsp; </center>
<hr><a name="Registration"><h2>Object Registries names and descriptions.</h2></a>

<p>
The goal of the framework is to provide some capability of introspection to the application. Introspection allows programs to examine themselves, determine what objects are instantiated, and for what types as well as to get descriptive information about each object. For the spectrodaq client framework, introspection is achieved via:
<p>
<ul>
<li>Object registries (dictionaries of objects)<li>Object class hierarchy positioning information<li>Object description member functions.  For a simple application example see \ref regExample "Registration Example" below.  \section registries   The intent of object registries and the application registry is to allow a program to determine what set of objects from what general class types are currently instantiated, and to get pointers to a specific object, given its name, for later manipulation.  This registration of objects allows: - Objects to circularly reference each other for communication purposes - In the future: we will be able to provide support for Tcl/Tk commands   to list, create and manipulate objects by their names, allowing for   "programming free" configuration of software given that an appropriate   set of classes exists and is linked into the application.  Each application using an application framework contains a single instance of an \link CApplicationRegistry application registry.  The static function <a class="el" href="classCApplicationRegistry.html#d0">CApplicationRegistry::getInstance</a> retrieves a pointer to this registry.</ul>
Application registries are a subclass of the <a class="el" href="classCClassifiedObjectRegistry.html">CClassifiedObjectRegistry</a> class. classified object registries contain several <a class="el" href="classCObjectRegistry.html">CObjectRegistry</a> objects. Each  of these object registries is a dictionary of classes for a particular type of object.
<p>
Most classes in the framework are descended from the <a class="el" href="classCRegisteredObject.html">CRegisteredObject</a> class. This class of object registers itself in the appropriate registry on  construction, and removes itself from the appropriate registry on destruction. Subclasses usually provide two types of constructors:<ul>
<li>Anonymous object constructors - These constructors choose a unique but meaningless name for the object and register the object under that name in the appopriate object registry.<li>Named object constructors - These constructors allow you to choose a name for the object and register the object under that name in the appropriate object registry. If an object of the selected name already exists in the registry, a <a class="el" href="classCDuplicateNameException.html">CDuplicateNameException</a> will be thrown from the  constructor.</ul>
The application registry can be searched for specific objects within a  specific registry or the registries themselves can be iterated through and  objects enumerated or searched for in each registry.
<p>
<a name="Hierarchyinfo"><h2>Object class hierarchy positioning information.</h2></a>

<p>
<a class="el" href="classCNamedObject.html">CNamedObject</a> derived classes provide two member functions to support retrieving information about the place of the object in the class hierarchy. This is  intended to be descriptive information, rather than information which can be used from within a program. (To programmatically manipulate object types, it is better to use the C++ RTTI subsystem.):<ul>
<li><a class="el" href="classCNamedObject.html#b2">CNamedObject::AppendClassInfo</a> should be called from within the constructor of an application class. This member function, allows a string which describes the full class derivation to be built up.<li><a class="el" href="classCNamedObject.html#a5">CNamedObject::getClassPath</a> Can be called to return this class derivation string.</ul>
<a name="SelfDescription"><h2>Object Description member functions.</h2></a>

<p>
<a class="el" href="classCNamedObject.html">CNamedObject</a> derived classes implement the member function  <a class="el" href="classCNamedObject.html#a8">DescribeSelf().</a> DescribeSelf provides a human readable dump of the current state of an object. If you implement DescribeSelf() be sure to call your base class DescribeSelf so that the full state of the object can be produced.
<p>
<a name="regExample"><h2>Registration Example.</h2></a>

<p>
The example in this section shows how to create objects which make full use of the introspective features of the class hierarchy. The example creates two Events, a <a class="el" href="classCTimerEvent.html">Timer event</a> and a <a class="el" href="classCFileEvent.html">file event.</a>
<p>
The file event accepts numeric input on stdin, locates the timer event by name, describes it and schedules it to run in single shot mode after n seconds where n is just the number the user typed in. If a non-numeric value is entered, the application exits.
<p>
<div class="fragment"><pre><font class="preprocessor">#include &lt;spectrodaq.h&gt;</font>
<font class="preprocessor">#include &lt;<a class="code" href="SpectroFramework_8h.html">SpectroFramework.h</a>&gt;</font>
<font class="preprocessor">#include &lt;iostream.h&gt;</font>
<font class="preprocessor">#include &lt;unistd.h&gt;</font>
<font class="preprocessor">#include &lt;stdlib.h&gt;</font>
<font class="preprocessor">#include &lt;string&gt;</font>

<font class="comment">//</font>
<font class="comment">// Timer class intended to be 'remote controlled' by name.</font>
<font class="comment">//</font>
<font class="keyword">class </font>MyTimer : <font class="keyword">public</font> <a class="code" href="classCTimerEvent.html">CTimerEvent</a>
{
<font class="keyword">public</font>:
  MyTimer(<font class="keyword">const</font> <font class="keywordtype">char</font>* pName);
  <font class="keyword">virtual</font> <font class="keywordtype">void</font> <a class="code" href="classCTimerEvent.html#a10">OnTimer</a>();
  <font class="keyword">virtual</font> string <a class="code" href="classCTimerEvent.html#a12">DescribeSelf</a>();
};
<font class="comment">//  The constructor registers us, with the given name, however</font>
<font class="comment">//  since we won't be enabled, the initial timeout is 0 and we create</font>
<font class="comment">//  ourselves in norepeat mode.</font>
<font class="comment">//</font>
MyTimer::MyTimer(<font class="keyword">const</font> <font class="keywordtype">char</font>* pName) :
  <a class="code" href="classCTimerEvent.html">CTimerEvent</a>(pName, 0, false)
{
  AppendClassInfo();            <font class="comment">// Add our place in class hierarchy.</font>
}
<font class="comment">//  OnTimer is called when the timer does expire.. it just types out</font>
<font class="comment">//  "Timer fired" and it's description.</font>
<font class="comment">//</font>
<font class="keywordtype">void</font>
<a class="code" href="classCTimerEvent.html#a10">MyTimer::OnTimer</a>()
{
  cout &lt;&lt; <font class="stringliteral">"A MyTimer object fired:"</font> &lt;&lt; endl;
  cout &lt;&lt; DescribeSelf() &lt;&lt; endl;
  cout &lt;&lt; <font class="stringliteral">"------------------------------------------"</font> &lt;&lt; endl;
}
string 
<a class="code" href="classCTimerEvent.html#a12">MyTimer::DescribeSelf</a>()
{
  string result;
  result = <font class="stringliteral">"My timer object (one shot remote controlled timer).\n"</font>;
  result += <a class="code" href="classCTimerEvent.html#a12">CTimerEvent::DescribeSelf</a>();

  <font class="keywordflow">return</font> result;
}


<font class="comment">// Fd class to monitor stdin and remote control a timer based on numeric</font>
<font class="comment">// input.  Note that the thread exits if non-numeric input is received.</font>
<font class="comment">// </font>
<font class="keyword">class </font>Stdin : <font class="keyword">public</font> <a class="code" href="classCFileEvent.html">CFileEvent</a>
{
  string m_TimerName;
<font class="keyword">public</font>:
  Stdin(<font class="keyword">const</font> <font class="keywordtype">char</font>* pName, <font class="keyword">const</font> string&amp; rTimerName);
  <font class="keyword">virtual</font> <font class="keywordtype">void</font> <a class="code" href="classCFileEvent.html#a15">OnReadable</a>(istream &amp;  rInput  );
  <font class="keyword">virtual</font> string <a class="code" href="classCFileEvent.html#a19">DescribeSelf</a>();
<font class="keyword">protected</font>:
  <font class="keywordtype">void</font>         StartTimer(<font class="keywordtype">int</font> nSeconds);
  <a class="code" href="classCTimerEvent.html">CTimerEvent</a>* LocateTimer();
};

<font class="comment">// Constructor creates us on STDIN_FILENO registered as per name:</font>
<font class="comment">//</font>
Stdin::Stdin(<font class="keyword">const</font> <font class="keywordtype">char</font> *pName, <font class="keyword">const</font> string&amp; rTimerName) : 
  <a class="code" href="classCFileEvent.html">CFileEvent</a>(STDIN_FILENO, string(pName)),
  m_TimerName(rTimerName)
{
  AppendClassInfo();            <font class="comment">// Add our place in class hierarchy.</font>
}
<font class="comment">//</font>
<font class="comment">// OnReadable reads a number, locates and fires off the timer:</font>
<font class="comment">//</font>
<font class="keywordtype">void</font>
<a class="code" href="classCFileEvent.html#a15">Stdin::OnReadable</a>(istream&amp; rInput)
{
  <font class="keywordtype">char</font> number[100];
  <font class="keywordtype">int</font>  nsec;

  rInput &gt;&gt; number;
  nsec = atoi(number);

  <font class="keywordflow">if</font>(nsec != 0) {
    StartTimer(nsec);
  }
  <font class="keywordflow">else</font> {
    setEnable(<font class="keyword">false</font>);           <font class="comment">// Disable ourselves.</font>
  }
}

<font class="comment">// Describe ourself:</font>
<font class="comment">//</font>
string
<a class="code" href="classCFileEvent.html#a19">Stdin::DescribeSelf</a>()
{
  string result;
  result = <font class="stringliteral">" Stdin  object controlling the timer: "</font>;
  result += m_TimerName;
  result += <font class="charliteral">'\n'</font>;
  result += <a class="code" href="classCFileEvent.html#a19">CFileEvent::DescribeSelf</a>();

  <font class="keywordflow">return</font> result;
}
<font class="comment">//</font>
<font class="comment">// Start timer locates the timer, sets its timeout and enables it:</font>
<font class="comment">//</font>
<font class="keywordtype">void</font>
Stdin::StartTimer(<font class="keywordtype">int</font> nseconds)
{
  nseconds = nseconds * 1000;   <font class="comment">// Timer needs milliseconds, not seconds.</font>
  <a class="code" href="classCTimerEvent.html">CTimerEvent</a>* pTimer = LocateTimer();
  <font class="keywordflow">if</font>(pTimer) {
    pTimer-&gt;<a class="code" href="classCTimerEvent.html#a8">SetTimeout</a>(nseconds);
    pTimer-&gt;<a class="code" href="classCTimerEvent.html#a6">Enable</a>();
  }
  <font class="keywordflow">else</font> {
    cerr &lt;&lt; <font class="stringliteral">"Stdin::StartTimer(): The timer "</font> &lt;&lt; m_TimerName;
    cerr &lt;&lt; <font class="stringliteral">" Does not exist in: "</font> &lt;&lt; endl;
    cerr &lt;&lt; DescribeSelf();
  }
}
<font class="comment">//</font>
<font class="comment">//  Locates the named timer controlled by this StdIn object.</font>
<font class="comment">//</font>
<a class="code" href="classCTimerEvent.html">CTimerEvent</a>*
Stdin::LocateTimer()
{
  <a class="code" href="classCClassifiedObjectRegistry.html">CClassifiedObjectRegistry</a>* pRegistry = <a class="code" href="classCApplicationRegistry.html#d0">CApplicationRegistry::getInstance</a>();
  <font class="keywordflow">try</font> {
    <a class="code" href="CObjectRegistry_8h.html#a0">ObjectIterator</a> p = pRegistry-&gt;<a class="code" href="classCClassifiedObjectRegistry.html#a7">Find</a>(string(<font class="stringliteral">"Events"</font>), m_TimerName);
    <font class="keywordflow">return</font> (<a class="code" href="classCTimerEvent.html">CTimerEvent</a>*)(p-&gt;second);
  }
  <font class="keywordflow">catch</font> (<a class="code" href="classCNoSuchObjectException.html">CNoSuchObjectException</a>&amp; rExcept) { <font class="comment">// Timer not found.</font>
    <font class="keywordflow">return</font> (<a class="code" href="classCTimerEvent.html">CTimerEvent</a>*)NULL;
  }
  
}

<font class="keyword">class </font>MyApp : <font class="keyword">public</font> DAQROCNode
{
<font class="keyword">protected</font>:
  <font class="keywordtype">int</font> operator()(<font class="keywordtype">int</font> argc, <font class="keywordtype">char</font>** argv);
};

MyApp theApplication;

<font class="keywordtype">int</font>
MyApp::operator()(<font class="keywordtype">int</font> argc, <font class="keywordtype">char</font>** argv)
{
  <font class="comment">// Create and describe the timer, but don't enable it.. that's done</font>
  <font class="comment">// by StdIn's object.</font>

  MyTimer timer(<font class="stringliteral">"A timer"</font>);
  cout &lt;&lt; <font class="stringliteral">"Created a timer: "</font> &lt;&lt; timer.DescribeSelf() &lt;&lt; endl;

  <font class="comment">// Create an Stdin which controls the timer:</font>

  Stdin TimerController(<font class="stringliteral">"TimerControl"</font>, string(<font class="stringliteral">"A timer"</font>));
  cout &lt;&lt; <font class="stringliteral">"Starting Stdin object: "</font> &lt;&lt; TimerController.DescribeSelf() &lt;&lt; endl;
  TimerController.Enable();

  DAQThreadId id = TimerController.getThreadId();
  Join(id);
  
}
</pre></div>
<p>
<hr><address align="right"><small>Generated on Tue Feb 4 12:35:50 2003 for Spectrodaq External Event Framework by
<a href="http://www.doxygen.org/index.html">
<img src="doxygen.png" alt="doxygen" align="middle" border=0 
width=110 height=53></a>1.2.15 </small></address>
</body>
</html>

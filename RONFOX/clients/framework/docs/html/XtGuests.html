<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.0 Transitional//EN">
<html><head><meta http-equiv="Content-Type" content="text/html;charset=iso-8859-1">
<title>Xt/X11 event loops.</title>
<link href="doxygen.css" rel="stylesheet" type="text/css">
</head><body>
<!-- Generated by Doxygen 1.2.15 -->
<center>
<a class="qindex" href="main.html">Main Page</a> &nbsp; <a class="qindex" href="namespaces.html">Namespace List</a> &nbsp; <a class="qindex" href="hierarchy.html">Class Hierarchy</a> &nbsp; <a class="qindex" href="classes.html">Alphabetical List</a> &nbsp; <a class="qindex" href="annotated.html">Compound List</a> &nbsp; <a class="qindex" href="files.html">File List</a> &nbsp; <a class="qindex" href="functions.html">Compound Members</a> &nbsp; <a class="qindex" href="globals.html">File Members</a> &nbsp; <a class="qindex" href="pages.html">Related Pages</a> &nbsp; </center>
<hr><a name="XtGuests"><h2>Xt/X11 event loops.</h2></a>

<p>
Support for Xt/X11 event loops allows framework software to take advantage of the rich GUI functionality offered by Xwindows widget libraries such as the Athena widget library or Motif widgets. The Xt event loop is fully  synchronized with the application. The event loop structure looks like:
<p>
<div class="fragment"><pre>  <font class="keywordflow">while</font>(!m_fExit) {
    XEvent event;

    XtAppNextEvent(m_AppContext, &amp;event);
    pMutex-&gt;Lock(); {           <font class="comment">//--&gt; Begin Critical region.</font>
      XtDispatchEvent(&amp;event);
    }
    pMutex-&gt;UnLock();           <font class="comment">//&lt;-- End Critical region.</font>

  }
</pre></div>
<p>
Xt event dispatch is bracketed by Lock and Unlock calls on the application  serialization mutex ensuring that all Xt Event processing is done synchronized to the application.
<p>
To include an Xt event loop in your application you must:<ul>
<li>Create a subclass of the <a class="el" href="classCXtEventLoop.html">CXtEventLoop</a> class.<li>Fill in the following member functions with application specific code:<ol>
<li><a class="el" href="classCXtEventLoop.html#b6">InitializeApplication()</a> (see <a href="XtGuests.html#InitializeApplication">Application initialization.</a> below).<li><a class="el" href="classCXtEventLoop.html#b7">SetupApplicationResources()</a> (see  <a href="XtGuests.html#SetupApplicationResources">Setting up the application resource</a> below).<li><a class="el" href="classCXtEventLoop.html#b8">SetupWidgetTree()</a> (see <a href="XtGuests.html#SetupWidgetTree">Setting up the application's initial widget tree.</a> below).</ol>
<li>Create an instance of the event loop in the application object<li>Schedule the event loop for execution.</ul>
<a name="InitializeApplication"><h2>Application initialization.</h2></a>
 If the default application initialization is not sufficient, you can implement an override to this function. The default contents of the function are: <div class="fragment"><pre>Widget
<a class="code" href="classCXtEventLoop.html#b6">CXtEventLoop::InitializeApplication</a>(<font class="keywordtype">int</font>&amp; argc, <font class="keywordtype">char</font>** argv)
{
  m_TopLevel = XtAppInitialize(&amp;m_AppContext,
                               m_sClass.c_str(),
                               m_pOptionTable,
                               m_nOptionCount,
                               &amp;argc, argv,
                               m_ppcFallbackResources,
                               NULL, 0);
  <font class="keywordflow">return</font> m_TopLevel;

}
</pre></div>
<p>
This initializes the Xt library, and produces the application top level widget. You can write your member to modify the class (m_sClass), the option table  (m_pOptionTable), and the application fallback resources  (m_ppcFallbackResources) prior to calling <a class="el" href="classCXtEventLoop.html#b6">CXtEventLoop::InitializeApplication</a>
<p>
You can also detect and process application specific "Command line parameters."
<p>
<a name="SetupApplicationResources"><h2>Setting up the application resource</h2></a>
 database.
<p>
The attributes of widgets and classes of widgets are defined both by explicit properties at widget creation or modification time, and by a set of  defaults or "resources." The resources are loaded into a resource database from several sources:<ul>
<li>A set of 'fallback' resources can be loaded at Xt initialization time in <a class="el" href="classCXtEventLoop.html#b6">InitializeApplication().</a><li>A set of default resources may be loaded into the Xt library in the function  described in this section (<a class="el" href="classCXtEventLoop.html#b7">SetupApplicationResources()</a>).<li>The resources can be loaded in from files in the X11 resource directory and from resource specifications in a user application specific resource file.</ul>
The function <a class="el" href="classCXtEventLoop.html#b7">SetupApplicationResources()</a> provides a hook to allow default application resources to be loaded into the system. The call signature for this member is: <div class="fragment"><pre><font class="keywordtype">void</font>   SetupApplicationResources (Widget TopLevel);
</pre></div> Where: <dl compact><dt><b>
Parameters: </b><dd>
<table border=0 cellspacing=2 cellpadding=0>
<tr><td valign=top><em>Toplevel</em>&nbsp;</td><td>
is the top level widget created in  <a class="el" href="classCXtEventLoop.html#b6">InitializeApplication()</a></td></tr>
</table>
</dl>The default behavior of this member is empty. For more information on X11 resources and the resource database, consult the relevant Xt and X11  programming documentation.
<p>
<a name="SetupWidgetTree"><h2>Setting up the application's initial widget tree.</h2></a>

<p>
Xt applications consist of a hierachical set of GUI components called  "widgets." <a class="el" href="classCXtEventLoop.html#b8">SetupWidgetTree</a> allows the initial set of widgets to be created.
<p>
The call signature of this member is: <div class="fragment"><pre><font class="keywordtype">void</font> 
<a class="code" href="classCXtEventLoop.html#b8">CXtEventLoop::SetupWidgetTree</a>(Widget TopLevel)
</pre></div>
<p>
Where: <dl compact><dt><b>
Parameters: </b><dd>
<table border=0 cellspacing=2 cellpadding=0>
<tr><td valign=top><em>TopLevel</em>&nbsp;</td><td>
is the toplevel widget. All application widgets have this  widget as an ultimate parent.</td></tr>
</table>
</dl>The default implementation of <a class="el" href="classCXtEventLoop.html#b8">SetupWidgetTree</a> is empty. It is up to the application to determine its user interface
<p>
<a name="Example"><h2>:</h2></a>
 The example below creates a single button which when clicked exits the Xt event loop.
<p>
<div class="fragment"><pre><font class="comment">//</font>
<font class="comment">// Tests the Xt event loop as a separate thread.</font>
<font class="comment">//</font>
<font class="preprocessor">#include &lt;spectrodaq.h&gt;</font>
<font class="preprocessor">#include &lt;<a class="code" href="CXtEventLoop_8h.html">CXtEventLoop.h</a>&gt;</font>
<font class="preprocessor">#include &lt;<a class="code" href="XMPushbutton_8h.html">XMPushbutton.h</a>&gt;</font>
<font class="preprocessor">#include &lt;iostream.h&gt;</font>
<font class="keyword">class </font>CXMApplication : <font class="keyword">public</font> <a class="code" href="classCXtEventLoop.html">CXtEventLoop</a>
{
  <a class="code" href="classXMPushButton.html">XMPushButton</a>* m_pButton;
<font class="keyword">protected</font>:
  <font class="keyword">virtual</font> <font class="keywordtype">void</font> <a class="code" href="classCXtEventLoop.html#b8">SetupWidgetTree</a>(Widget top)
  {
    cerr &lt;&lt; <font class="stringliteral">"Setting up widget tree\n"</font>;
    cerr.flush();
    m_pButton = <font class="keyword">new</font> <a class="code" href="classXMPushButton.html">XMPushButton</a>(<font class="stringliteral">"Exit"</font>,
                                 top,
                                 CXMApplication::Exit,
                                 (XtPointer)<font class="keyword">this</font>);
    m_pButton-&gt;<a class="code" href="classXMWidget.html#a16">Manage</a>();
    cerr &lt;&lt; <font class="stringliteral">"Widget Tree set up.\n"</font>;
    cerr.flush();
  }
<font class="keyword">public</font>:
  CXMApplication() :
    m_pButton(0)
  {
    cerr &lt;&lt; <font class="stringliteral">"Motif app constructed\n"</font>;
    cerr.flush();
  }

<font class="keyword">private</font>:
  <font class="keyword">static</font> <font class="keywordtype">void</font>  Exit(<a class="code" href="classXMWidget.html">XMWidget</a>* pMyWidget, XtPointer cd, XtPointer reason)
  {
    CXMApplication* pMe = (CXMApplication*)cd;
    <font class="keyword">delete</font> pMe-&gt;m_pButton;
    pMe-&gt;exit();
  }

};

<font class="keyword">class </font>Main : <font class="keyword">public</font> DAQROCNode
{
  <font class="keywordtype">int</font> operator()(<font class="keywordtype">int</font> argc, <font class="keywordtype">char</font>** argv)
  {
    CXMApplication app;
    DAQThreadId   tid = daq_dispatcher.Dispatch(app);
    DAQStatus     stat;

    Join(tid, &amp;stat);
    cerr &lt;&lt; <font class="stringliteral">"Motif gui thread exited: "</font> &lt;&lt; stat.GetStatusCode() &lt;&lt; endl;
    <font class="keywordflow">return</font> 0;
  }
};

<font class="keyword">static</font> Main myApp;
</pre></div>
<p>
<hr><address align="right"><small>Generated on Tue Feb 4 12:35:51 2003 for Spectrodaq External Event Framework by
<a href="http://www.doxygen.org/index.html">
<img src="doxygen.png" alt="doxygen" align="middle" border=0 
width=110 height=53></a>1.2.15 </small></address>
</body>
</html>

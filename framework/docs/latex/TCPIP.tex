\section{TCP/IP client server programming}\label{TCPIP}


Modern TCP/IP network aware programs generally divide into two roles; clients and servers.

Servers therefore have responsibilities:\begin{enumerate}
\item 
Listen for connection requests from new clients on a specified \char`\"{}service port.\char`\"{}\item 
Respond to work requests by existing, connected clients.\end{enumerate}
Client responsibilities are much simpler:\begin{enumerate}
\item 
Form a connection with a server\item 
Ask the server to do work, receive and analyze the server response.\end{enumerate}
In the spectrodaq framework, clients and servers are represented by the {\bf CSocket} {\rm (p.\,\pageref{classCSocket})} class. Sockets are used differently depending on whether or not the program is acting as a client or a server.

Server Sockets are wrapped in objects derived from the {\bf CServer\-Connection\-Event} {\rm (p.\,\pageref{classCServerConnectionEvent})}  class. This class allows the programmer to set up a thread to listen for  connection events on a socket which has been bound to listen for connection requests on a specified service or port. When connections arrive, the event calls {\bf CServer\-Connection\-Event::On\-Connection} {\rm (p.\,\pageref{classCServerConnectionEvent_a12})} passing it a {\bf CSocket} {\rm (p.\,\pageref{classCSocket})} which represents the connection to the client.

Application specific code can do whatever it wants at this time.  Normally, if the connection is valid, the application code will use the socket object to create a {\bf CServer\-Instance} {\rm (p.\,\pageref{classCServerInstance})} derived object. {\bf CServer\-Instance} {\rm (p.\,\pageref{classCServerInstance})}  encapsulates a request response protocol in which the server passively waits for client requests, reacts and replies to them.

In {\bf CServer\-Instance} {\rm (p.\,\pageref{classCServerInstance})} derived objects, {\bf CServer\-Instance::On\-Request} {\rm (p.\,\pageref{classCServerInstance_a9})} is called whenever the client has a new request for the server. The server can read the request from the socket passed to On\-Request, process it and return information to the client by writing it along the socket.


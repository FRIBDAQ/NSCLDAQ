#
# SBS Technologies dataBlizzard install script
#
KERNDIR=/usr/src/linux

echo "SBS Technologies datablizzard driver source install script"
echo "Note Modified files are backed up as fn.rem-sbsdb"

if [ ! -d $KERNDIR ]
then
	echo -n "KERNDIR="$KERNDIR" is not found"
	echo -n "Create a link to the linux kernel source to install the driver"
	exit -1
fi

DRIVERSKCONFIG=$KERNDIR/drivers/Kconfig
DRIVERSMAKEFILE=$KERNDIR/drivers/Makefile
DRIVERSSBSDB=$KERNDIR/drivers/sbsdb
DRIVERCONF_BASE=/etc

#
# Check if our driver string is present
#
grep "sbsdb" $DRIVERSMAKEFILE > /dev/null 2>&1
if [ $? -eq 0 ]
then

#
# Remove our driver string
#
echo "Backing up $DRIVERSMAKEFILE to $DRIVERSMAKEFILE.rem-sbsdb"

cp -f $DRIVERSMAKEFILE $DRIVERSMAKEFILE.rem-sbsdb

echo "Removing driver string from $DRIVERSMAKEFILE ..."

ed $DRIVERSMAKEFILE > /dev/null 2>&1 << EOF
g/sbsdb
d
.
w
EOF

else

echo "Driver string not present in "$DRIVERSMAKEFILE

fi

#
# Check if our driver string is present
#
grep "sbsdb" $DRIVERSKCONFIG > /dev/null 2>&1
if [ $? -eq 0 ]
then

#
# Remove our driver string
#
echo "Backing up $DRIVERSKCONFIG to $DRIVERSKCONFIG.rem-sbsdb"

cp -f $DRIVERSKCONFIG $DRIVERSKCONFIG.rem-sbsdb

echo "Removing driver string from $DRIVERSKCONFIG ..."

ed $DRIVERSKCONFIG > /dev/null 2>&1 << EOF
g/sbsdb
d
d
.
w
EOF

else

echo "Driver string not present in "$DRIVERSKCONFIG

fi

echo "Removing driver source files from kernel"
rm -fr $DRIVERSSBSDB

echo "Removing driver configuration file btp.conf from "$DRIVERCONF_BASE
rm -f $DRIVERCONF_BASE/btp.conf

echo "Removal Completed Successfully"

exit 0
